{% extends "base.html" %}
{% block title %}–†–∞—Å—Å—ã–ª–∫–∞ –≤ –õ–°{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile_edit.css') }}">
<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –Ω–µ–π—Ä–æ—Å–ø–∞–º–º–µ—Ä–∞ */
    .neuro-spammer-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1050;
        overflow-x: hidden;
        overflow-y: auto;
        outline: 0;
    }
    .neuro-spammer-modal.show {
        display: block;
    }
    .neuro-spammer-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
    }
    .neuro-spammer-modal-dialog {
        position: relative;
        width: 100%;
        max-width: 900px;
        margin: 30px auto;
        pointer-events: none;
    }
    .neuro-spammer-modal-content {
        position: relative;
        display: flex;
        flex-direction: column;
        background-color: #252935;
        border: 1px solid #2a2e3a;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        pointer-events: auto;
        max-height: 85vh;
        overflow: hidden;
    }
    .neuro-spammer-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        padding-bottom: 0;
        background-color: #252935;
    }
    .neuro-spammer-modal-title {
        margin: 0;
        font-size: 20px;
        font-weight: 500;
        color: #e0e0e0;
    }
    .btn-close {
        background: none;
        border: none;
        font-size: 28px;
        line-height: 1;
        color: #a0a0a0;
        cursor: pointer;
        padding: 0;
        margin: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s;
    }
    .btn-close:hover {
        background-color: #3a3a3a;
        color: #ffffff;
    }
    .neuro-spammer-modal-body {
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        flex-grow: 1;
        background: #252935;
        overflow-y: auto;
    }
    .neuro-spammer-format-info {
        background-color: #1c1f28;
        padding: 14px 18px;
        border-radius: 8px;
        border-left: 4px solid #4067c5;
        font-size: 14px;
    }
    .neuro-spammer-format-info p {
        margin: 0 0 10px 0;
        font-weight: 500;
        color: #e0e0e0;
    }
    .neuro-spammer-format-info pre {
        margin: 0;
        font-family: 'Courier New', Courier, monospace;
        white-space: pre-wrap;
        word-break: break-all;
        color: #a0a0a0;
        font-size: 13px;
        line-height: 1.6;
    }
    .neuro-spammer-textarea-wrapper {
        position: relative;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    .neuro-spammer-textarea-container {
        position: relative;
        flex-grow: 1;
        display: flex;
        background-color: #1c1f28;
        border: 1px solid #2a2e3a;
        border-radius: 8px;
        overflow: hidden;
    }
    .line-numbers {
        background-color: #1a1d26;
        color: #6c757d;
        padding: 12px 12px 12px 8px;
        text-align: right;
        font-family: 'Courier New', Courier, monospace;
        font-size: 14px;
        line-height: 21px;
        user-select: none;
        border-right: 1px solid #2a2e3a;
        min-width: 50px;
        overflow: hidden;
        white-space: pre;
    }
    .neuro-spammer-textarea {
        width: 100%;
        min-height: 350px;
        resize: none;
        padding: 12px 12px 12px 8px;
        font-family: 'Courier New', Courier, monospace;
        font-size: 14px;
        line-height: 21px;
        border: none;
        box-sizing: border-box;
        background-color: #1c1f28;
        color: #e0e0e0;
        flex-grow: 1;
        overflow-y: auto;
        overflow-x: auto;
    }
    .neuro-spammer-textarea:focus {
        outline: none;
    }
    .neuro-spammer-textarea::placeholder {
        color: #6c757d;
        opacity: 1;
    }
    .neuro-spammer-modal-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        background-color: #252935;
        border-top: 1px solid #2a2e3a;
    }
    .footer-left {
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .search-toggle-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        background: linear-gradient(145deg, #5c8aff, #4c7cff);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        font-weight: 500;
    }
    .search-toggle-btn:hover {
        background: linear-gradient(145deg, #4c7cff, #3f6fd3);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(92, 138, 255, 0.3);
    }
    .search-toggle-btn.active {
        background: linear-gradient(145deg, #3f6fd3, #2f5ba0);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .search-toggle-btn .search-icon {
        width: 16px;
        height: 16px;
    }
    .search-toggle-btn .search-text {
        white-space: nowrap;
    }
    .search-container {
        display: flex;
        align-items: center;
        background-color: #1c1f28;
        border: 1px solid #2a2e3a;
        border-radius: 8px;
        padding: 6px 12px;
        min-width: 280px;
        margin-left: 8px;
    }
    .search-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        width: 100%;
    }
    .search-input-icon {
        color: #6c757d;
        margin-right: 8px;
        flex-shrink: 0;
        width: 16px;
        height: 16px;
    }
    .search-input {
        background: transparent;
        border: none;
        color: #e0e0e0;
        font-size: 14px;
        flex: 1;
        outline: none;
        padding: 4px 0;
    }
    .search-input::placeholder {
        color: #6c757d;
    }
    .clear-search-btn {
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        display: none;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        margin-left: 4px;
    }
    .clear-search-btn:hover {
        background-color: #2a2e3a;
        color: #e0e0e0;
    }
    .row-count {
        font-size: 14px;
        color: #a0a0a0;
        margin-left: 16px;
    }
    /* --- –°—Ç–∏–ª–∏ –¥–ª—è —à–∏—Ä–æ–∫–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ (–†–µ–¥–∞–∫—Ç–æ—Ä + –ü—Ä–µ–≤—å—é) --- */
.neuro-spammer-modal-dialog.full-width {
    max-width: 1400px; /* –®–∏—Ä–æ–∫–æ–µ –æ–∫–Ω–æ */
    height: 90vh;
    margin: 2vh auto;
    display: flex;
    gap: 20px;
    pointer-events: none; /* –ß—Ç–æ–±—ã –∫–ª–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ */
}

/* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (–†–µ–¥–∞–∫—Ç–æ—Ä) */
.neuro-spammer-modal-content.editor-pane {
    flex: 1;
    pointer-events: auto;
    display: flex;
    flex-direction: column;
    max-height: 100%;
    background-color: #2d2d2d;
    border: 1px solid #2a2e3a;
}

/* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (–ü—Ä–µ–≤—å—é) */
.neuro-spammer-modal-content.preview-pane {
    flex: 0 0 400px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–∞–∫ —É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
    pointer-events: auto;
    display: flex;
    flex-direction: column;
    border: 1px solid #2a2e3a;
    overflow: hidden;
    position: relative;
    background: #2d2d2d; /* –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω –∫–∞–∫ —É –∫–∞—Ä—Ç–æ—á–µ–∫ */
}

/* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω –ø—Ä–µ–≤—å—é (–∏–º–∏—Ç–∞—Ü–∏—è Telegram) */
.preview-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    background: linear-gradient(135deg, #252935 0%, #1c1f28 100%);
    opacity: 0.9;
}
.preview-content-wrapper {
    position: relative;
    z-index: 1;
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 20px;
}

/* –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
.editor-toolbar {
    padding: 10px 24px;
    background-color: #252935;
    border-bottom: 1px solid #2a2e3a;
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    align-items: center;
}

.toolbar-btn {
    background: #3a3a3a;
    border: 1px solid #4a4a4a;
    color: #a0a0a0;
    width: 36px;
    height: 36px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    padding: 0;
}
.toolbar-btn:hover {
    background: #4067c5;
    color: white;
    border-color: #4067c5;
}

.toolbar-separator {
    width: 1px;
    height: 24px;
    background: #4a4a4a;
    margin: 0 8px;
}

/* –°—Ç–∏–ª–∏ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ –≤ —Ç—É–ª–±–∞—Ä–µ */
.toolbar-dropdown {
    position: relative;
    display: inline-block;
}

.toolbar-dropdown-content {
    display: none;
    position: absolute;
    background-color: #2d2d2d;
    min-width: 220px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.5);
    border: 1px solid #4a4a4a;
    border-radius: 6px;
    z-index: 1060;
    top: 100%;
    left: 0;
}

.toolbar-dropdown-content a {
    color: #e0e0e0;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    font-size: 14px;
    cursor: pointer;
}

.toolbar-dropdown-content a:hover {
    background-color: #3a3a3a;
    color: white;
}

.toolbar-dropdown:hover .toolbar-dropdown-content {
    display: block;
}
/* –ë–∞–±–±–ª —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–µ–≤—å—é */
.message-preview-bubble {
    background: #4067c5; /* –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏–Ω–∏–π —Ü–≤–µ—Ç –∏–∑ –≤–∞—à–µ–π –ø–∞–ª–∏—Ç—Ä—ã */
    color: #ffffff;
    padding: 12px 16px;
    border-radius: 12px 12px 12px 0;
    max-width: 85%;
    margin-top: auto; /* –ü—Ä–∏–∂–∞—Ç—å –∫ –Ω–∏–∑—É */
    margin-bottom: 40px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-size: 15px;
    line-height: 1.4;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    word-wrap: break-word;
    white-space: pre-wrap;
    border: 1px solid #4c7cff;
}
.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #e0e0e0;
    margin-bottom: 20px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
.preview-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #e0e0e0;
    margin-top: 10px;
}

.preview-icon-btn {
    background: none;
    border: none;
    color: #a0a0a0;
    cursor: pointer;
    padding: 5px;
    transition: color 0.2s;
}

.preview-icon-btn:hover {
    color: #ffffff;
}

.preview-title {
    font-size: 18px;
    font-weight: 600;
    color: #e0e0e0;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–æ–π–ª–µ—Ä–∞ –≤ –ø—Ä–µ–≤—å—é */
.tg-spoiler {
    background: #666 !important;
    color: transparent !important;
    cursor: pointer;
    border-radius: 4px;
    padding: 1px 4px;
}

.tg-spoiler:hover {
    background: #555 !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–¥–∞ –≤ –ø—Ä–µ–≤—å—é */
code {
    background: rgba(255,255,255,0.1) !important;
    padding: 2px 4px !important;
    border-radius: 4px !important;
    color: #e0e0e0 !important;
    font-family: 'Courier New', monospace !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ –ø—Ä–µ–≤—å—é */
a {
    color: #5c8aff !important;
    text-decoration: none !important;
}

a:hover {
    text-decoration: underline !important;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 1200px) {
    .neuro-spammer-modal-dialog.full-width {
        flex-direction: column;
        max-width: 95%;
        height: 95vh;
    }
    
    .neuro-spammer-modal-content.preview-pane {
        flex: 0 0 300px;
        max-width: 100%;
    }
}

.preview-icon-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.preview-icon-btn.disabled:hover {
    color: #a0a0a0;
}
</style>
{% endblock %}
{% block content %}
<div class="proxy-page">
    <h1 class="page-title">–†–∞—Å—Å—ã–ª–∫–∞ –≤ –õ–°</h1>

    <!-- –ö–Ω–æ–ø–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤/—Ñ–∞–π–ª–æ–≤ -->
    <div class="card">
        <div class="card-body">
            <div class="file-buttons-container">
                <button class="btn btn-light" id="btn-dm-recipients">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    –ü–æ–ª—É—á–∞—Ç–µ–ª–∏
                    <span class="section-button-counter ms-1" id="recipients-counter">0</span>
                </button>
                <button class="btn btn-light" id="btn-dm-message">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                    </svg>
                    –°–æ–æ–±—â–µ–Ω–∏–µ
                </button>
                <button class="btn btn-light" id="btn-dm-attachments">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                        <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                        <circle cx="10" cy="12" r="2"></circle>
                        <path d="m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"></path>
                    </svg>
                    –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
                    <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –≤—ã –¥–æ–±–∞–≤–∏—Ç–µ –≤ —Å–æ—Ñ—Ç —Ñ–∞–π–ª—ã, —Ç–æ –∫ –∫–∞–∂–¥–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –±—É–¥–µ—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–π–ª –∏–∑ —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞. –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –≤–∏–¥–µ–æ-–∫—Ä—É–∂–æ—á–∫–∏ - —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <path d="M12 17h.01"></path>
                        </svg>
                    </span>
                </button>
                <button class="btn btn-light" id="btn-dm-links">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                    –°—Å—ã–ª–∫–∏
                    <span class="help-icon" data-tooltip="–í—ã –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–∏ —Å—Å—ã–ª–∫–∏ –ø—Ä—è–º–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∞ –º–æ–∂–µ—Ç–µ –≤–ø–∏—Å–∞—Ç—å –∏—Ö –æ—Ç–¥–µ–ª—å–Ω–æ –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫, —á—Ç–æ–±—ã –∏—Ö –±—ã–ª–æ —É–¥–æ–±–Ω–µ–µ –∏ –±—ã—Å—Ç—Ä–µ–µ –∑–∞–º–µ–Ω–∏—Ç—å.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <path d="M12 17h.01"></path>
                        </svg>
                    </span>
                </button>
                <button class="btn btn-light" id="btn-dm-reports">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect>
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                        <path d="m9 14 2 2 4-4"></path>
                    </svg>
                    –û—Ç—á—ë—Ç—ã
                </button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –ª–∏–º–∏—Ç—ã) -->
    <div class="card">
        <div class="card-body">
            <div class="options-container">
                <div>
                    <label for="delayBetweenSends" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ —Å –∞–∫–∫–∞—É–Ω—Ç–∞</label>
                    <span class="help-icon" data-tooltip="–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä: 5-20.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                    </span>
                    <div class="input-group" style="max-width: 200px">
                        <input class="form-control has-trailing-label" id="delayBetweenSends" value="0">
                        <span class="input-trailing-label">—Å–µ–∫</span>
                        <div class="invalid-feedback" id="invalid-feedback-for-delayBetweenSends"></div>
                    </div>
                </div>
                <div>
                    <label for="totalSendsLimit" class="form-label">–û–±—â–∏–π –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</label>
                    <span class="help-icon" data-tooltip="–õ–∏–º–∏—Ç —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫ —Å–æ –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Å—É–º–º–∞—Ä–Ω–æ.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                    </span>
                    <div class="input-group" style="max-width: 200px">
                        <input class="form-control rounded-end" id="totalSendsLimit" placeholder="–û—Ç–∫–ª—é—á–µ–Ω–æ">
                        <div class="invalid-feedback" id="invalid-feedback-for-totalSendsLimit"></div>
                    </div>
                </div>
                <div>
                    <label for="perAccountSendsLimit" class="form-label">–õ–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∞–∫–∫–∞—É–Ω—Ç–∞</label>
                    <div class="input-group" style="max-width: 200px">
                        <input class="form-control rounded-end" id="perAccountSendsLimit" value="50">
                        <div class="invalid-feedback" id="invalid-feedback-for-perAccountSendsLimit"></div>
                    </div>
                </div>
                <div>
                    <label for="spamBlockErrorsToSkip" class="form-label">–°–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ —Å–ø–∞–º–±–ª–æ–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å</label>
                    <span class="help-icon" data-tooltip="–¢–µ–ª–µ–≥—Ä–∞–º –º–æ–∂–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å–ø–∞–º–±–ª–æ–∫–∞. –£–∫–∞–∂–∏—Ç–µ, —Å–∫–æ–ª—å–∫–æ —Ç–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–∂–¥–µ —á–µ–º —Å—á–∏—Ç–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                    </span>
                    <div class="input-group" style="max-width: 200px">
                        <input class="form-control rounded-end" id="spamBlockErrorsToSkip" value="5">
                        <div class="invalid-feedback" id="invalid-feedback-for-spamBlockErrorsToSkip"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –†–µ–∂–∏–º –±–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π -->
    <div class="card">
        <div class="card-body">
            <h3 class="subsection-title subsection-title-collapse collapsed" id="noOverlapHeader">
                –†–∞—Å—Å—ã–ª–∫–∞ –≤ —Ä–µ–∂–∏–º–µ "–ë–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π"
                <svg class="svg-icon collapse-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4px" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg>
            </h3>
            <div class="collapse" id="noOverlapOptions">
                <div class="options-container">
                    <div>
                        <label for="contentRepeatCount" class="form-label">–ü–æ–≤—Ç–æ—Ä—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
                        <span class="help-icon" data-tooltip="–î–ª—è —Å–∫–æ–ª—å–∫–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–Ω—Ç–µ–Ω—Ç. –£–∫–∞–∂–∏—Ç–µ 1, —á—Ç–æ–±—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–±–µ–≥–∞—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control rounded-end" id="contentRepeatCount" value="1">
                            <div class="invalid-feedback" id="invalid-feedback-for-contentRepeatCount"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ –¥–∏–∞–ª–æ–≥–∏ -->
    <div class="card">
        <div class="card-body">
            <h3 class="subsection-title subsection-title-collapse collapsed" id="contactsHeader">
                –†–∞—Å—Å—ã–ª–∫–∞ –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º –∏ –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–∏–∞–ª–æ–≥–∞–º
                <svg class="svg-icon collapse-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4px" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg>
            </h3>
            <div class="collapse" id="contactsOptions">
                <div class="alert alert-primary alert-subsection-description" role="alert">–ï—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º –∏–ª–∏ –ø–æ –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–∏–∞–ª–æ–≥–∞–º, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –Ω–µ –±–µ—Ä—É—Ç—Å—è –≤ —Ä–∞–±–æ—Ç—É.</div>
                <div class="options-container">
                    <div>
                        <label for="sendToContacts" class="form-label">–°–ø–∞–º–∏—Ç—å –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º</label>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="sendToContacts">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-sendToContacts"></div>
                        </div>
                    </div>
                    <div>
                        <label for="sendToOpenDialogs" class="form-label">–°–ø–∞–º–∏—Ç—å –ø–æ –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–∏–∞–ª–æ–≥–∞–º</label>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="sendToOpenDialogs">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-sendToOpenDialogs"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Ç–≤–µ—Ç—ã –Ω–∞ —Å—Ç–æ—Ä–∏—Å -->
    <div class="card">
        <div class="card-body">
            <h3 class="subsection-title subsection-title-collapse collapsed" id="storiesHeader">
                –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–∏—Å
                <svg class="svg-icon collapse-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4px" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg>
            </h3>
            <div class="collapse" id="storiesOptions">
                <div class="options-container">
                    <div>
                        <label for="enableStoriesReplies" class="form-label">–í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ —Å—Ç–æ—Ä–∏—Å</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Å—Ç–æ—Ä–∏—Å, —Å–æ–æ–±—â–µ–Ω–∏–µ —É–π–¥—ë—Ç –∫–∞–∫ –æ—Ç–≤–µ—Ç –Ω–∞ —Å—Ç–æ—Ä–∏—Å. –ò–Ω–∞—á–µ ‚Äî —Å–æ—Ñ—Ç —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π –Ω–∏–∂–µ.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enableStoriesReplies">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-enableStoriesReplies"></div>
                        </div>
                    </div>
                    <div>
                        <label for="sendPlainIfNoStory" class="form-label">–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç —Å—Ç–æ—Ä–∏—Å</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —Å—Ç–æ—Ä–∏—Å, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="sendPlainIfNoStory" checked>
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-sendPlainIfNoStory"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–µ–∫—Ä–µ—Ç–Ω—ã–µ —á–∞—Ç—ã -->
    <div class="card">
        <div class="card-body">
            <h3 class="subsection-title subsection-title-collapse collapsed" id="secretChatsHeader">
                –†–∞—Å—Å—ã–ª–∫–∞ –ø–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–º —á–∞—Ç–∞–º
                <svg class="svg-icon collapse-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4px" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg>
            </h3>
            <div class="collapse" id="secretChatsOptions">
                <div class="options-container">
                    <div>
                        <label for="maxSecretChatCreationDelay" class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞</label>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control has-trailing-label" id="maxSecretChatCreationDelay" value="1500">
                            <span class="input-trailing-label">—Å–µ–∫</span>
                            <div class="invalid-feedback" id="invalid-feedback-for-maxSecretChatCreationDelay"></div>
                        </div>
                    </div>
                    <div>
                        <label for="secretChatAcceptTimeout" class="form-label">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–∏—è —á–∞—Ç–∞</label>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control has-trailing-label" id="secretChatAcceptTimeout" value="120">
                            <span class="input-trailing-label">—Å–µ–∫</span>
                            <div class="invalid-feedback" id="invalid-feedback-for-secretChatAcceptTimeout"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –£–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ -->
    <div class="card">
        <div class="card-body">
            <h3 class="subsection-title subsection-title-collapse collapsed" id="imageUniqHeader">
                –£–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫
                <svg class="svg-icon collapse-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4px" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg>
            </h3>
            <div class="collapse" id="imageUniqOptions">
                <div class="options-container">
                    <div>
                        <label for="enableImageUniq" class="form-label">–£–Ω–∏–∫–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏</label>
                        <span class="help-icon" data-tooltip="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ª—ë–≥–∫–∞—è —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π (—Ä–∞–∑–º–µ—Ä, —Ü–≤–µ—Ç–∞ –∏ —Ç.–ø.).">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enableImageUniq">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-enableImageUniq"></div>
                        </div>
                    </div>
                    <div>
                        <label for="maxResizePercent" class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞</label>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control has-trailing-label" id="maxResizePercent" value="15">
                            <span class="input-trailing-label">%</span>
                            <div class="invalid-feedback" id="invalid-feedback-for-maxResizePercent"></div>
                        </div>
                    </div>
                    <div>
                        <label for="maxOverlayOpacityPercent" class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ —Ü–≤–µ—Ç–Ω–æ–≥–æ –Ω–∞–ª–æ–∂–µ–Ω–∏—è</label>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control has-trailing-label" id="maxOverlayOpacityPercent" value="10">
                            <span class="input-trailing-label">%</span>
                            <div class="invalid-feedback" id="invalid-feedback-for-maxOverlayOpacityPercent"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ -->
    <div class="card">
        <div class="card-body">
            <h3 class="subsection-title subsection-title-collapse collapsed" id="extraOptionsHeader">
                –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
                <svg class="svg-icon collapse-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4px" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg>
            </h3>
            <div class="collapse" id="extraOptions">
                <div class="options-container">
                    <div>
                        <label for="messageEffect" class="form-label">–≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π</label>
                        <select class="form-select rounded-end" id="messageEffect" style="width: 200px">
                            <option value="–ë–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤" selected>–ë–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</option>
                            <option value="üëç">üëç</option>
                            <option value="üëé">üëé</option>
                            <option value="‚ù§Ô∏è">‚ù§Ô∏è</option>
                            <option value="üî•">üî•</option>
                            <option value="üéâ">üéâ</option>
                            <option value="üí©">üí©</option>
                        </select>
                    </div>
                    <div>
                        <label for="allowLinkPreview" class="form-label">–†–∞–∑—Ä–µ—à–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Å—ã–ª–æ–∫</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞, –¢–µ–ª–µ–≥—Ä–∞–º –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä. –û—Ç–∫–ª—é—á–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="allowLinkPreview">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-allowLinkPreview"></div>
                        </div>
                    </div>
                    <div>
                        <label for="markSpamBlockInDb" class="form-label">–°—Ç–∞–≤–∏—Ç—å –º–µ—Ç–∫—É "–°–ø–∞–º–±–ª–æ–∫" –≤ –±–∞–∑–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</label>
                        <span class="help-icon" data-tooltip="–ü–æ–º–µ—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—É—á–µ–Ω—ã –æ—à–∏–±–∫–∏ —Å–ø–∞–º–±–ª–æ–∫–∞, —á—Ç–æ–±—ã –Ω–µ –±—Ä–∞—Ç—å –∏—Ö –≤ —Ä–∞–±–æ—Ç—É –ø–æ–∑–∂–µ.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="markSpamBlockInDb">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-markSpamBlockInDb"></div>
                        </div>
                    </div>
                    <div>
                        <label for="maxAllowedDelay" class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –¢–µ–ª–µ–≥—Ä–∞–º –≤—ã–¥–∞—Å—Ç –∑–∞–¥–µ—Ä–∂–∫—É –±–æ–ª—å—à–µ —É–∫–∞–∑–∞–Ω–Ω–æ–π, –∞–∫–∫–∞—É–Ω—Ç –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É. –ï—Å–ª–∏ –º–µ–Ω—å—à–µ ‚Äî –ø–æ–¥–æ–∂–¥—ë—Ç –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control has-trailing-label" id="maxAllowedDelay" value="800">
                            <span class="input-trailing-label">—Å–µ–∫</span>
                            <div class="invalid-feedback" id="invalid-feedback-for-maxAllowedDelay"></div>
                        </div>
                    </div>
                    <div>
                        <label for="sendWelcomeSticker" class="form-label">–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–∏–∫–µ—Ä</label>
                        <span class="help-icon" data-tooltip="–ü–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –¢–µ–ª–µ–≥—Ä–∞–º–æ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–∏–∫–µ—Ä.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="sendWelcomeSticker">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-sendWelcomeSticker"></div>
                        </div>
                    </div>
                    <div>
                        <label for="welcomeStickerDelay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å—Ç–∏–∫–µ—Ä–∞</label>
                        <span class="help-icon" data-tooltip="–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä: 5-20.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control rounded-end" id="welcomeStickerDelay" value="0">
                            <div class="invalid-feedback" id="invalid-feedback-for-welcomeStickerDelay"></div>
                        </div>
                    </div>
                    <div>
                        <label for="hideMediaWithSpoiler" class="form-label">–°–∫—Ä—ã–≤–∞—Ç—å –º–µ–¥–∏–∞ –ø–æ–¥ —Å–ø–æ–π–ª–µ—Ä–æ–º</label>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="hideMediaWithSpoiler">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-hideMediaWithSpoiler"></div>
                        </div>
                    </div>
                    <div>
                        <label for="sendSilently" class="form-label">–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –±–µ–∑ –∑–≤—É–∫–∞</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –ï—Å–ª–∏ —Ç–µ–ª–µ–≥—Ä–∞–º –æ—Ç–∫—Ä—ã—Ç ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="sendSilently">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-sendSilently"></div>
                        </div>
                    </div>
                    <div>
                        <label for="pinAfterSend" class="form-label">–ó–∞–∫—Ä–µ–ø–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="pinAfterSend">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-pinAfterSend"></div>
                        </div>
                    </div>
                    <div>
                        <label for="deleteDialogAfterSend" class="form-label">–£–¥–∞–ª—è—Ç—å –¥–∏–∞–ª–æ–≥ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
                        <span class="help-icon" data-tooltip="–í–Ω–∏–º–∞–Ω–∏–µ: –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤. –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="deleteDialogAfterSend">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-deleteDialogAfterSend"></div>
                        </div>
                    </div>
                    <div>
                        <label for="blockRecipientAfterSend" class="form-label">–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="blockRecipientAfterSend">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-blockRecipientAfterSend"></div>
                        </div>
                    </div>
                    <div>
                        <label for="sendVideoAsCircle" class="form-label">–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ –≤ –∫—Ä—É–∂–æ—á–∫–µ</label>
                        <span class="help-icon" data-tooltip="–í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º –∏ –Ω–µ –±–æ–ª–µ–µ 640√ó640, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ –∫—Ä—É–∂–æ–∫.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="sendVideoAsCircle">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-sendVideoAsCircle"></div>
                        </div>
                    </div>
                    <div>
                        <label for="selfDestructTimer" class="form-label">–¢–∞–π–º–µ—Ä –¥–ª—è —É–Ω–∏—á—Ç–æ–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ —á–∏—Å–ª–æ ‚Äî —Ñ–∞–π–ª—ã –±—É–¥—É—Ç —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–∞—é—â–∏–º–∏—Å—è.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control has-trailing-label" id="selfDestructTimer" placeholder="–û—Ç–∫–ª—é—á–µ–Ω–æ">
                            <span class="input-trailing-label">—Å–µ–∫</span>
                            <div class="invalid-feedback" id="invalid-feedback-for-selfDestructTimer"></div>
                        </div>
                    </div>
                    <div>
                        <label for="maxConsecutiveSpamBlocks" class="form-label">–ú–∞–∫—Å–∏–º—É–º —Å–ø–∞–º–±–ª–æ–∫–æ–≤ –ø–æ–¥—Ä—è–¥</label>
                        <span class="help-icon" data-tooltip="–ü—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å: –µ—Å–ª–∏ –ø–æ–¥—Ä—è–¥ –º–Ω–æ–≥–æ —Å–ø–∞–º–±–ª–æ–∫–æ–≤ —Å 0 –æ—Ç–ø—Ä–∞–≤–æ–∫ ‚Äî —Ä–∞—Å—Å—ã–ª–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control rounded-end" id="maxConsecutiveSpamBlocks" value="30">
                            <div class="invalid-feedback" id="invalid-feedback-for-maxConsecutiveSpamBlocks"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ -->
<div class="start-task-btn-group">
    <button type="button" class="start-task-btn" id="start-dm-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg>
        –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
    </button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞–ø—É—Å–∫–∞ -->
<div class="modal" id="dmTaskModal">
    <div class="modal-content">
        <div class="modal-body">
            <div class="options-container">
                <div class="mb-4">
                    <button class="btn btn-primary w-100" id="select-accounts-btn">
                        <span>–ê–∫–∫–∞—É–Ω—Ç—ã</span>
                        <span class="mx-1 opacity-50">|</span>
                        <span id="accounts-picked-for-task-count">0</span>
                    </button>
                </div>
                <div>
                    <label for="threadCount" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤</label>
                    <span class="help-icon ms-1" data-tooltip="–°–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                    </span>
                    <div class="input-group">
                        <input class="form-control" id="threadCount" type="number" min="1" max="50" value="1">
                        <div class="invalid-feedback" id="invalid-feedback-for-threadCount"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary btn-lg" id="do-start-dm-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path></svg>
                <span>–ó–∞–ø—É—Å—Ç–∏—Ç—å</span>
            </button>
        </div>
    </div>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π DM -->
<div id="dmRecipientsModal" class="neuro-spammer-modal">
    <div class="neuro-spammer-modal-overlay"></div>
    <div class="neuro-spammer-modal-dialog">
        <div class="neuro-spammer-modal-content">
            <div class="neuro-spammer-modal-header">
                <h5 class="neuro-spammer-modal-title">–ü–æ–ª—É—á–∞—Ç–µ–ª–∏</h5>
                <button type="button" class="btn-close" id="closeDmRecipientsModalBtn">&times;</button>
            </div>
            <div class="neuro-spammer-modal-body">
                <div class="neuro-spammer-format-info">
                    <p>–í–≤–µ–¥–∏—Ç–µ username –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫–µ):</p>
@username
                </div>
                <div class="neuro-spammer-textarea-wrapper">
                    <div class="neuro-spammer-textarea-container">
                        <div class="line-numbers" id="lineNumbersDmRecipients"></div>
                        <textarea id="dmRecipientsTextarea" class="neuro-spammer-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π..."></textarea>
                    </div>
                </div>
            </div>
            <div class="neuro-spammer-modal-footer">
                <div class="footer-left">
                    <button class="search-toggle-btn" id="searchToggleDmRecipients">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        –ü–æ–∏—Å–∫
                    </button>
                    <div class="search-container" style="display: none;">
                        <svg class="search-input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <input type="text" id="searchInputDmRecipients" class="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞...">
                        <button class="clear-search-btn" id="clearSearchDmRecipients" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>
                    <div class="row-count">–°—Ç—Ä–æ–∫: <span id="dmRecipientsLineCount">0</span></div>
                </div>
                <button type="button" class="btn btn-primary" id="saveDmRecipientsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –°–æ–æ–±—â–µ–Ω–∏—è (–†–µ–¥–∞–∫—Ç–æ—Ä + –ü—Ä–µ–≤—å—é) -->
<div id="dmMessageModal" class="neuro-spammer-modal">
    <div class="neuro-spammer-modal-overlay"></div>
    <div class="neuro-spammer-modal-dialog full-width">
        
        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –†–µ–¥–∞–∫—Ç–æ—Ä -->
        <div class="neuro-spammer-modal-content editor-pane">
            <div class="neuro-spammer-modal-header">
                <h5 class="neuro-spammer-modal-title">–°–æ–æ–±—â–µ–Ω–∏–µ</h5>
                <button type="button" class="btn-close" id="closeDmMessageModalBtn">&times;</button>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
            <div class="editor-toolbar">
                <button type="button" class="toolbar-btn" title="–ñ–∏—Ä–Ω—ã–π" onclick="insertTag('dmMessageTextarea', '<b>', '</b>')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8"></path></svg>
                </button>
                <button type="button" class="toolbar-btn" title="–ö—É—Ä—Å–∏–≤" onclick="insertTag('dmMessageTextarea', '<i>', '</i>')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" x2="10" y1="4" y2="4"></line><line x1="14" x2="5" y1="20" y2="20"></line><line x1="15" x2="9" y1="4" y2="20"></line></svg>
                </button>
                <button type="button" class="toolbar-btn" title="–ó–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π" onclick="insertTag('dmMessageTextarea', '<s>', '</s>')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4H9a3 3 0 0 0-2.83 4"></path><path d="M14 12a4 4 0 0 1 0 8H6"></path><line x1="4" x2="20" y1="12" y2="12"></line></svg>
                </button>
                <button type="button" class="toolbar-btn" title="–°–ø–æ–π–ª–µ—Ä" onclick="insertTag('dmMessageTextarea', '<tg-spoiler>', '</tg-spoiler>')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"></path><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path><line x1="2" x2="22" y1="2" y2="22"></line></svg>
                </button>
                <button type="button" class="toolbar-btn" title="–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π" onclick="insertTag('dmMessageTextarea', '`', '`')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                </button>
                <button type="button" class="toolbar-btn" title="–°—Å—ã–ª–∫–∞" onclick="insertTag('dmMessageTextarea', '<a href=\'URL\'>', '</a>')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                </button>
                
                <div class="toolbar-separator"></div>
                
                <button type="button" class="toolbar-btn" title="–°–ø–∏–Ω—Ç–∞–∫—Å (—Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è)" onclick="insertTag('dmMessageTextarea', '{', '|}')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H7a2 2 0 0 0-2 2v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5c0 1.1.9 2 2 2h1"></path><path d="M16 21h1a2 2 0 0 0 2-2v-5c0-1.1.9-2 2-2a2 2 0 0 1-2-2V5a2 2 0 0 0-2-2h-1"></path></svg>
                </button>
                
                <div class="toolbar-separator"></div>
                
                <!-- –î—Ä–æ–ø–¥–∞—É–Ω –º–∞–∫—Ä–æ—Å–æ–≤ –ø–æ–ª—É—á–∞—Ç–µ–ª—è -->
                <div class="toolbar-dropdown">
                    <button type="button" class="toolbar-btn" title="–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    </button>
                    <div class="toolbar-dropdown-content">
                        <a onclick="insertText('dmMessageTextarea', '%firstname%')">–ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è</a>
                        <a onclick="insertText('dmMessageTextarea', '%lastname%')">–§–∞–º–∏–ª–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è</a>
                        <a onclick="insertText('dmMessageTextarea', '%username%')">–Æ–∑–µ—Ä–Ω–µ–π–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è</a>
                    </div>
                </div>
            </div>

            <div class="neuro-spammer-textarea-wrapper">
                <div class="neuro-spammer-textarea-container">
                    <div class="line-numbers" id="lineNumbersDmMessage"></div>
                    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π textarea, —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ –¥–∏–∑–∞–π–Ω -->
                    <textarea id="dmMessageTextarea" class="neuro-spammer-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è... –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Spintax {–≤–∞—Ä–∏–∞–Ω—Ç1|–≤–∞—Ä–∏–∞–Ω—Ç2} –∏ HTML —Ç–µ–≥–∏."></textarea>
                </div>
            </div>
            
            <div class="neuro-spammer-modal-footer">
                <div class="footer-left">
                    <!-- –ë–ª–æ–∫ –ø–æ–∏—Å–∫–∞ —Ç–∞–∫–æ–π –∂–µ –∫–∞–∫ –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥–∞–ª–∫–∞ -->
                    <button class="search-toggle-btn" id="searchToggleDmMessage">
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        –ü–æ–∏—Å–∫
                    </button>
                    <div class="search-container" id="searchContainerDmMessage" style="display: none;">
                         <svg class="search-input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <input type="text" id="searchInputDmMessage" class="search-input" placeholder="–ü–æ–∏—Å–∫...">
                        <button class="clear-search-btn" id="clearSearchDmMessage">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>
                    <div class="row-count">–°—Ç—Ä–æ–∫: <span id="dmMessageLineCount">0</span></div>
                </div>
                <button type="button" class="btn btn-primary" id="saveDmMessageBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –ü—Ä–µ–≤—å—é -->
        <div class="neuro-spammer-modal-content preview-pane">
            <div class="preview-background"></div>
            <div class="preview-content-wrapper">
                <div class="preview-header">
                    <!-- –ü—É—Å—Ç–∞—è –∏–∫–æ–Ω–∫–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ -->
                    <svg width="24" height="24" style="visibility: hidden;"><path d="m12 19-7-7 7-7"></path></svg>
                    <div class="preview-title" id="previewTitle">–°–æ–æ–±—â–µ–Ω–∏–µ #1</div>
                    <button class="preview-icon-btn" title="–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é" id="refreshPreviewBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                    </button>
                </div>
                
                <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div id="messagePreviewBubble" class="message-preview-bubble">
                    –ü—Ä–∏–≤–µ—Ç
                </div>
                
                <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã —Å–Ω–∏–∑—É (–Ω–∞ –±—É–¥—É—â–µ–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ª–∏—Å—Ç–∞—Ç—å –≤–∞—Ä–∏–∞—Ü–∏–∏) -->
                <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã —Å–Ω–∏–∑—É -->
                <div class="preview-controls">
                    <!-- –î–æ–±–∞–≤–ª–µ–Ω id="prevPreviewVariant" –∏ onclick -->
                    <button class="preview-icon-btn disabled" id="prevPreviewVariant" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg>
                    </button>
                    
                    <button class="preview-icon-btn" title="–°–±—Ä–æ—Å–∏—Ç—å (–í–∞—Ä–∏–∞–Ω—Ç #1)" id="resetPreviewCycle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                    </button>
                    
                    <button class="preview-icon-btn" title="–°–ª–µ–¥—É—é—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç" id="nextPreviewVariant">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        
    </div>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Å—ã–ª–æ–∫ DM -->
<div id="dmLinksModal" class="neuro-spammer-modal">
    <div class="neuro-spammer-modal-overlay"></div>
    <div class="neuro-spammer-modal-dialog">
        <div class="neuro-spammer-modal-content">
            <div class="neuro-spammer-modal-header">
                <h5 class="neuro-spammer-modal-title">–°—Å—ã–ª–∫–∏</h5>
                <button type="button" class="btn-close" id="closeDmLinksModalBtn">&times;</button>
            </div>
            <div class="neuro-spammer-modal-body">
                <div class="neuro-spammer-format-info">
                    <p>–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫–∏ (–ø–æ –æ–¥–Ω–æ–π –≤ —Å—Ç—Ä–æ–∫–µ):</p>
                    <pre>https://example.com
https://another-link.org</pre>
                </div>
                <div class="neuro-spammer-textarea-wrapper">
                    <div class="neuro-spammer-textarea-container">
                        <div class="line-numbers" id="lineNumbersDmLinks"></div>
                        <textarea id="dmLinksTextarea" class="neuro-spammer-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫–∏..."></textarea>
                    </div>
                </div>
            </div>
            <div class="neuro-spammer-modal-footer">
                <div class="footer-left">
                    <button class="search-toggle-btn" id="searchToggleDmLinks">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        –ü–æ–∏—Å–∫
                    </button>
                    <div class="search-container" style="display: none;">
                        <svg class="search-input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <input type="text" id="searchInputDmLinks" class="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞...">
                        <button class="clear-search-btn" id="clearSearchDmLinks" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>
                    <div class="row-count">–°—Ç—Ä–æ–∫: <span id="dmLinksLineCount">0</span></div>
                </div>
                <button type="button" class="btn btn-primary" id="saveDmLinksBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ -->
<div class="modal" id="accountsModal" style="display: none;">
    <div class="modal-content" style="width: 90%; max-width: 1200px; height: 80vh;">
        <div class="modal-header">
            <h5 class="modal-title">–í—ã–±–æ—Ä –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h5>
            <button type="button" class="modal-close" id="accountsModalClose">&times;</button>
        </div>
        <div class="modal-body" style="height: calc(100% - 120px); overflow: hidden;">
            <div class="proxy-container" style="height: 100%;">
                <div class="header-section">
                    <div class="table-controls">
                        <div class="account-folder-selector">
                            <button class="account-folder-btn active" id="all-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã</div>
                                <div class="active-indicator"></div>
                            </button>
                            <button class="account-folder-btn" id="working-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–î–ª—è —Ä–∞–±–æ—Ç—ã</div>
                                <div class="active-indicator"></div>
                            </button>
                            <button class="account-folder-btn" id="archive-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–ê—Ä—Ö–∏–≤</div>
                                <div class="active-indicator"></div>
                            </button>
                            <button class="account-folder-btn" id="no-spam-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–ë–µ–∑ —Å–ø–∞–º–±–ª–æ–∫–∞</div>
                                <div class="active-indicator"></div>
                            </button>
                            <button class="account-folder-btn" id="with-spam-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–°–ø–∞–º–±–ª–æ–∫</div>
                                <div class="active-indicator"></div>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-body p-3 d-flex align-items-center">
                        <div class="d-flex gap-2">
                            <button class="btn btn-light" id="select-all-accounts-modal">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 7 17l-5-5"></path><path d="m22 10-7.5 7.5L13 16"></path></svg>
                            </button>
                            <button id="deselect-all-btn-modal" type="button" class="btn btn-light">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                            </button>
                        </div>
                        <span class="text-muted ms-auto" id="accounts-count-label-modal">–ü–æ–∫–∞–∑–∞–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: 0 / 0</span>
                    </div>
                </div>

                <div style="height: calc(100% - 200px); overflow-y: auto;">
                    <table id="accounts-table-modal" class="proxy-table">
                        <thead>
                            <tr>
                                <th class="selector-header"><input type="checkbox" id="select-all-checkbox-modal" class="select-all-checkbox"></th>
                                <th>#</th>
                                <th>–ê–≤–∞—Ç–∞—Ä</th>
                                <th><div class="sortable-header" data-sort="phone">–¢–µ–ª–µ—Ñ–æ–Ω<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                                <th><div class="sortable-header" data-sort="geo">–ì–µ–æ<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                                <th><div class="sortable-header" data-sort="status">–°—Ç–∞—Ç—É—Å<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                                <th>–û—Ç–ª–µ–∂–∫–∞</th>
                                <th><div class="sortable-header" data-sort="role">–†–æ–ª—å<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                                <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω</th>
                                <th><div class="sortable-header" data-sort="name">–ò–º—è<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="accountsModalCancel">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn btn-primary" id="confirmAccountsSelection">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å (<span id="selected-count-modal">0</span>)</button>
        </div>
    </div>
</div>

<div id="customTooltip" class="custom-tooltip"></div>

<script>
// –†–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–æ–¥–∞–ª–æ–∫ –∏ —Ç–∞–±–ª–∏—Ü—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∏–∑ profile_edit
let selectedAccounts = new Set();
let allAccounts = [];
let currentFolder = 'all';
let currentSpamFilter = null;
let currentSort = { field: null, direction: 'asc' };
let searchFilter = '';
let roleFilter = '';
let geoFilter = '';
let statusFilter = '';
let currentSpintaxState = {};
let variantIndex = 0;
let currentPreviewSeed = 0;
let debounceTimer;

// --- –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏ –Ω–µ–π—Ä–æ—Å–ø–∞–º–º–µ—Ä–∞ ---
// --- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ ---
let neuroSpammerLists = {
    recipients: [],
    productDescription: '',
    dialogScripting: [],
    greeting: [],
    arguments: [],
    slang: [],
    exclude: [],
    dmRecipients: [],  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
    dmLinks: []        // ‚Üê –î–û–ë–ê–í–ò–¢–¨
};

neuroSpammerLists.dmMessage = "";


function insertTag(textareaId, openTag, closeTag) {
    const textarea = document.getElementById(textareaId);
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = textarea.value;
    const selectedText = text.substring(start, end);
    
    const newText = text.substring(0, start) + openTag + selectedText + closeTag + text.substring(end);
    textarea.value = newText;
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –∏ –∫—É—Ä—Å–æ—Ä
    textarea.focus();
    textarea.selectionStart = start + openTag.length;
    textarea.selectionEnd = end + openTag.length;
    
    // –¢—Ä–∏–≥–≥–µ—Ä–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    textarea.dispatchEvent(new Event('input'));
}

function insertText(textareaId, textToInsert) {
    const textarea = document.getElementById(textareaId);
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = textarea.value;
    
    const newText = text.substring(0, start) + textToInsert + text.substring(end);
    textarea.value = newText;
    
    textarea.focus();
    textarea.selectionStart = start + textToInsert.length;
    textarea.selectionEnd = start + textToInsert.length;
    
    textarea.dispatchEvent(new Event('input'));
}

function parseSpintax(text, seed = null) {
    if (!text) return "";
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º Mulberry32 ‚Äî –æ–Ω –¥–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ 
    // –¥–∞–∂–µ –¥–ª—è —Å–æ—Å–µ–¥–Ω–∏—Ö —á–∏—Å–µ–ª (0, 1, 2...)
    const createRandom = (s) => {
        return () => {
            s = s + 0x6D2B79F5;
            let t = Math.imul(s ^ s >>> 15, s | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    };

    const getRandom = seed !== null ? createRandom(seed) : Math.random;
    
    function processSpintax(str) {
        // –†–µ–≥—É–ª—è—Ä–∫–∞ –∏—â–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ {a|b|c}
        // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —ç—Ç–∞ –≤–µ—Ä—Å–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø—Ä–æ—Ö–æ–¥
        // –î–ª—è –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ —Ü–∏–∫–ª–µ, –ø–æ–∫–∞ –µ—Å—Ç—å —Å–∫–æ–±–∫–∏
        const spintaxRegex = /\{([^{}]+?)\}/g;
        let result = str;
        let match;
        
        // –ü–æ–∫–∞ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ {..|..}, –∑–∞–º–µ–Ω—è–µ–º –∏—Ö
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–∏–∫–ª while —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
        let sanityCheck = 0;
        while (result.match(spintaxRegex) && sanityCheck < 10) {
             result = result.replace(spintaxRegex, (match, content) => {
                const options = content.split('|');
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ Seed
                const randomIndex = Math.floor(getRandom() * options.length);
                return options[randomIndex];
            });
            sanityCheck++;
        }
        
        return result;
    }
    
    return processSpintax(text);
}
function updateMessagePreview() {
    const rawText = document.getElementById('dmMessageTextarea').value;
    const previewBubble = document.getElementById('messagePreviewBubble');
    
    if (!rawText.trim()) {
        previewBubble.innerHTML = '<span style="color: #ccc; font-style: italic;">–ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...</span>';
        return;
    }

    // 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ Spintax
    let processedText = parseSpintax(rawText, currentPreviewSeed);
    
    // 2. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
    processedText = processedText
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\n/g, "<br>");
        
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–µ–≥–∏
    const allowedTags = [
        { tag: 'b', regex: /&lt;b&gt;(.*?)&lt;\/b&gt;/g, replace: '<b>$1</b>' },
        { tag: 'i', regex: /&lt;i&gt;(.*?)&lt;\/i&gt;/g, replace: '<i>$1</i>' },
        { tag: 's', regex: /&lt;s&gt;(.*?)&lt;\/s&gt;/g, replace: '<s>$1</s>' },
        { tag: 'u', regex: /&lt;u&gt;(.*?)&lt;\/u&gt;/g, replace: '<u>$1</u>' },
        { tag: 'spoiler', regex: /&lt;tg-spoiler&gt;(.*?)&lt;\/tg-spoiler&gt;/g, replace: '<span class="tg-spoiler" style="background: #666; color: transparent; cursor: pointer;" onclick="this.style.color=\'inherit\'; this.style.background=\'transparent\'">$1</span>' },
        { tag: 'code', regex: /`(.*?)`/g, replace: '<code style="background: rgba(255,255,255,0.1); padding: 2px 4px; border-radius: 4px; color: #e0e0e0; font-family: monospace;">$1</code>' }
    ];
    
    allowedTags.forEach(item => {
        processedText = processedText.replace(item.regex, item.replace);
    });
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Å—ã–ª–∫–∏
    processedText = processedText.replace(/&lt;a href=['"](.*?)['"]&gt;(.*?)&lt;\/a&gt;/g, '<a href="$1" target="_blank" style="color: #5c8aff; text-decoration: none;">$2</a>');

    previewBubble.innerHTML = processedText;
}



// CSS —Å—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–¥–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à CSS —Ñ–∞–π–ª)
const styles = `
<style>
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
}

.notification {
    min-width: 300px;
    max-width: 400px;
    padding: 12px 16px;
    background: #252935;
    border: 1px solid #2a2e3a;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
    opacity: 0;
    transform: translateX(400px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: auto;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.notification.show {
    opacity: 1;
    transform: translateX(0);
}

.notification.hide {
    opacity: 0;
    transform: translateX(400px);
}

.notification-icon {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.notification-content {
    flex: 1;
    min-width: 0;
}

.notification-message {
    color: #e0e0e0;
    font-size: 14px;
    line-height: 1.4;
    word-wrap: break-word;
}

.notification-close {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    transition: color 0.2s;
    border-radius: 4px;
}

.notification-close:hover {
    color: #e0e0e0;
    background: rgba(255, 255, 255, 0.05);
}

.notification.success {
    border-left: 3px solid #28a745;
}

.notification.success .notification-icon {
    color: #28a745;
}

.notification.error {
    border-left: 3px solid #dc3545;
}

.notification.error .notification-icon {
    color: #dc3545;
}

.notification.warning {
    border-left: 3px solid #ffc107;
}

.notification.warning .notification-icon {
    color: #ffc107;
}

.notification.info {
    border-left: 3px solid #5c8aff;
}

.notification.info .notification-icon {
    color: #5c8aff;
}

@media (max-width: 768px) {
    .notification-container {
        top: 10px;
        right: 10px;
        left: 10px;
    }
    
    .notification {
        min-width: auto;
        max-width: none;
    }
}
</style>
`;

// JavaScript –∫–ª–∞—Å—Å —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
class NotificationSystem {
    constructor() {
        this.container = null;
        this.init();
    }

    init() {
        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
        if (!document.getElementById('notification-styles')) {
            const styleElement = document.createElement('div');
            styleElement.id = 'notification-styles';
            styleElement.innerHTML = styles;
            document.head.appendChild(styleElement);
        }

        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        this.container = document.createElement('div');
        this.container.className = 'notification-container';
        document.body.appendChild(this.container);
    }

    show(message, type = 'info', duration = 3000) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;

        const iconSvg = this.getIcon(type);

        notification.innerHTML = `
            <div class="notification-icon">
                ${iconSvg}
            </div>
            <div class="notification-content">
                <div class="notification-message">${message}</div>
            </div>
            <button class="notification-close">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        `;

        this.container.appendChild(notification);

        setTimeout(() => {
            notification.classList.add('show');
        }, 10);

        const closeBtn = notification.querySelector('.notification-close');
        closeBtn.addEventListener('click', () => {
            this.hide(notification);
        });

        if (duration > 0) {
            setTimeout(() => {
                this.hide(notification);
            }, duration);
        }

        return notification;
    }

    hide(notification) {
        notification.classList.remove('show');
        notification.classList.add('hide');

        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }

    getIcon(type) {
        const icons = {
            success: `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            `,
            error: `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
            `,
            warning: `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            `,
            info: `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
            `
        };
        return icons[type] || icons.info;
    }

    success(message, duration = 3000) {
        return this.show(message, 'success', duration);
    }

    error(message, duration = 3000) {
        return this.show(message, 'error', duration);
    }

    warning(message, duration = 3000) {
        return this.show(message, 'warning', duration);
    }

    info(message, duration = 3000) {
        return this.show(message, 'info', duration);
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
const notifications = new NotificationSystem();




// --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏ ---
function openModal(modalId, listKey, textareaId, lineNumbersId, lineCountId) {
    const modal = document.getElementById(modalId);
    const textarea = document.getElementById(textareaId);
    modal.classList.add('show');
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
    if (Array.isArray(neuroSpammerLists[listKey])) {
        textarea.value = neuroSpammerLists[listKey].join('\n');
    } else {
        textarea.value = neuroSpammerLists[listKey];
    }
    updateLineNumbers(lineNumbersId, textareaId);
    updateLineCount(lineCountId, textareaId, listKey);
    resetSearch(listKey);
}

function closeModal(modalId, listKey) {
    const modal = document.getElementById(modalId);
    modal.classList.remove('show');
    resetSearch(listKey);
}

function updateLineNumbers(lineNumbersId, textareaId) {
    const textarea = document.getElementById(textareaId);
    const lineNumbers = document.getElementById(lineNumbersId);
    const lineCount = textarea.value.split('\n').length;
    let numbers = [];
    for (let i = 1; i <= lineCount; i++) {
        numbers.push(i);
    }
    lineNumbers.textContent = numbers.join('\n');
    lineNumbers.scrollTop = textarea.scrollTop;
}

function updateLineCount(lineCountId, textareaId, listKey) {
    const textarea = document.getElementById(textareaId);
    let count = 0;
    if (Array.isArray(neuroSpammerLists[listKey])) {
        const lines = textarea.value.split('\n').filter(line => line.trim() !== '');
        count = lines.length;
    } else {
        count = textarea.value.trim() ? 1 : 0;
    }
    document.getElementById(lineCountId).textContent = count;
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—á–µ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
    if (lineCountId === 'recipientsLineCount') {
        document.getElementById('counter-recipients').textContent = count;
    }
}

// --- –§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ---
let searchStates = {
    recipients: { active: false, originalList: [] },
    productDescription: { active: false, originalList: '' },
    dialogScripting: { active: false, originalList: [] },
    greeting: { active: false, originalList: [] },
    arguments: { active: false, originalList: [] },
    slang: { active: false, originalList: [] },
    exclude: { active: false, originalList: [] },
    dmRecipients: { active: false, originalList: [] },  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
    dmLinks: { active: false, originalList: [] }        // ‚Üê –î–û–ë–ê–í–ò–¢–¨
};

searchStates.dmMessage = { active: false, originalList: '' };

function toggleSearch(listKey) {
    if (searchStates[listKey].active) {
        hideSearch(listKey);
    } else {
        showSearch(listKey);
    }
}

function showSearch(listKey) {
    const searchContainerId = `searchContainer${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const searchToggleBtnId = `searchToggle${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const searchInputId = `searchInput${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const searchContainer = document.getElementById(searchContainerId);
    const searchToggleBtn = document.getElementById(searchToggleBtnId);
    const searchInput = document.getElementById(searchInputId);

    searchContainer.style.display = 'block';
    searchToggleBtn.classList.add('active');
    searchStates[listKey].active = true;
    setTimeout(() => {
        searchInput.focus();
    }, 100);
}

function hideSearch(listKey) {
    const searchContainerId = `searchContainer${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const searchToggleBtnId = `searchToggle${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const searchContainer = document.getElementById(searchContainerId);
    const searchToggleBtn = document.getElementById(searchToggleBtnId);

    searchContainer.style.display = 'none';
    searchToggleBtn.classList.remove('active');
    searchStates[listKey].active = false;
    resetSearch(listKey);
}

function performSearch(listKey) {
    const searchInputId = `searchInput${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const textareaId = `${listKey}Textarea`;
    const clearBtnId = `clearSearch${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const searchInput = document.getElementById(searchInputId);
    const searchTerm = searchInput.value.toLowerCase().trim();
    const textarea = document.getElementById(textareaId);
    const clearBtn = document.getElementById(clearBtnId);

    clearBtn.style.display = searchTerm ? 'flex' : 'none';

    if (searchTerm === '') {
        if (Array.isArray(searchStates[listKey].originalList)) {
            textarea.value = searchStates[listKey].originalList.join('\n');
        } else {
            textarea.value = searchStates[listKey].originalList;
        }
    } else {
        if (Array.isArray(searchStates[listKey].originalList)) {
            const filteredList = searchStates[listKey].originalList.filter(line =>
                line.toLowerCase().includes(searchTerm)
            );
            textarea.value = filteredList.join('\n');
        } else {
            // –î–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º
            textarea.value = searchStates[listKey].originalList.includes(searchTerm) ? searchStates[listKey].originalList : '';
        }
    }
    const lineCountId = `${listKey}LineCount`;
    updateLineCount(lineCountId, textareaId, listKey);
}

function resetSearch(listKey) {
    const searchInputId = `searchInput${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const textareaId = `${listKey}Textarea`;
    const clearBtnId = `clearSearch${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    const searchInput = document.getElementById(searchInputId);
    const clearBtn = document.getElementById(clearBtnId);
    const textarea = document.getElementById(textareaId);

    searchInput.value = '';
    clearBtn.style.display = 'none';
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
    if (Array.isArray(neuroSpammerLists[listKey])) {
        textarea.value = neuroSpammerLists[listKey].join('\n');
    } else {
        textarea.value = neuroSpammerLists[listKey];
    }
    const lineCountId = `${listKey}LineCount`;
    updateLineCount(lineCountId, textareaId, listKey);
}

function saveList(listKey, textareaId, modalId) {
    const textarea = document.getElementById(textareaId);
    // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–µ–Ω, —Å–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –µ–≥–æ
    const searchInputId = `searchInput${listKey.charAt(0).toUpperCase() + listKey.slice(1)}`;
    if (searchStates[listKey].active && document.getElementById(searchInputId).value.trim() !== '') {
        resetSearch(listKey);
    }
    const list = textarea.value.trim();
    if (list) {
        console.log(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ ${listKey}:`, list);
        if (Array.isArray(neuroSpammerLists[listKey])) {
            neuroSpammerLists[listKey] = textarea.value.split('\n');
        } else {
            neuroSpammerLists[listKey] = textarea.value;
        }
        notifications.success('–£—Å–ø–µ—à–Ω–æ!', `–°–ø–∏—Å–æ–∫ ${listKey} —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω`, 3000);
    } else {
        notifications.warning('–í–Ω–∏–º–∞–Ω–∏–µ', `–°–ø–∏—Å–æ–∫ ${listKey} –ø—É—Å—Ç`, 3000);
    }
    closeModal(modalId, listKey);
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
    const lineCountId = `${listKey}LineCount`;
    updateLineCount(lineCountId, textareaId, listKey);
}

function showModal(modalId) {
    document.getElementById(modalId).classList.add('show');
    document.getElementById(modalId).style.display = 'block';
}
function hideModal(modalId) {
    document.getElementById(modalId).classList.remove('show');
    setTimeout(() => { document.getElementById(modalId).style.display = 'none'; }, 1);
}
function updateSelectedAccountsCount() {
    const el = document.getElementById('accounts-picked-for-task-count');
    if (el) el.textContent = selectedAccounts.size;
    const el2 = document.getElementById('selected-count-modal');
    if (el2) el2.textContent = selectedAccounts.size;
}
function selectAllAccountsInModal() {
    document.querySelectorAll('.account-checkbox').forEach(checkbox => {
        const accountId = checkbox.getAttribute('data-account-id');
        selectedAccounts.add(accountId);
        checkbox.checked = true;
    });
    updateSelectedAccountsCount();
}
function deselectAllAccountsInModal() {
    selectedAccounts.clear();
    document.querySelectorAll('.account-checkbox').forEach(checkbox => { checkbox.checked = false; });
    updateSelectedAccountsCount();
}
async function loadAccounts(folder = 'all') {
    try {
        const response = await fetch('/get_accounts', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ folder }) });
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤');
        allAccounts = await response.json();
        renderAccountsTable();
        updateAccountsCount();
    } catch (e) { console.error(e); }
}
function getStatusClass(status) {
    switch (status) {
        case 'alive': return 'alive';
        case 'dead': return 'dead';
        case 'spam_block': return 'spam-block';
        default: return 'unknown';
    }
}
function getStatusText(status) {
    switch (status) {
        case 'alive': return '–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π';
        case 'dead': return '–ú–µ—Ä—Ç–≤';
        case 'spam_block': return '–°–ø–∞–º –±–ª–æ–∫';
        default: return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
    }
}
function getCountryData(){ return { RU:{name:'–†–æ—Å—Å–∏—è'}, UA:{name:'–£–∫—Ä–∞–∏–Ω–∞'}, KZ:{name:'–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω'}, US:{name:'–°–®–ê'} }; }
function getCountryInfo(code){ const m=getCountryData(); return m[code]||{name:code||'–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}; }
function getFlagEmoji(code){ if(!code) return 'üè≥Ô∏è'; const cps=code.toUpperCase().split('').map(c=>127397+c.charCodeAt(0)); try{ return String.fromCodePoint(...cps);}catch(e){return 'üè≥Ô∏è';}}

function renderAccountsTable() {
    const tbody = document.querySelector('#accounts-table-modal tbody');
    if (!tbody) return;
    tbody.innerHTML = (allAccounts || []).map((account, index) => {
        const fullName = `${account.first_name || ''} ${account.last_name || ''}`.trim();
        const countryInfo = getCountryInfo(account.geo);
        const flagEmoji = getFlagEmoji(account.geo);
        return `
            <tr data-account-id="${account.id}" class="account-row" style="cursor: pointer;">
                <td><input type="checkbox" class="account-checkbox" data-account-id="${account.id}" ${selectedAccounts.has(account.id) ? 'checked' : ''}></td>
                <td>${index + 1}</td>
                <td class="avatar-cell"><div class="avatar-placeholder">${(account.first_name||account.last_name||'?').toString().charAt(0).toUpperCase()}</div></td>
                <td>${account.phone || ''}</td>
                <td><div class="geo-cell" title="${countryInfo.name}"><span class="country-flag">${flagEmoji}</span><span class="country-code">${account.geo||''}</span></div></td>
                <td><span class="status-badge ${getStatusClass(account.status)}">${getStatusText(account.status)}</span></td>
                <td class="rest-period" data="${account.register_time}">${account.rest_until || '-'}</td>
                <td>${account.role || ''}</td>
                <td>${account.last_used || '–ù–µ—Ç'}</td>
                <td>${fullName || ''}</td>
            </tr>
        `;
    }).join('');

    document.querySelectorAll('.account-checkbox').forEach(cb => {
        cb.addEventListener('change', function(){
            const id = this.dataset.accountId;
            if (this.checked) selectedAccounts.add(id); else selectedAccounts.delete(id);
            updateSelectedAccountsCount();
        });
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
    document.querySelectorAll('#accounts-table-modal tbody tr').forEach(row => {
        row.addEventListener('click', function(e) {
            // –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫ –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —á–µ–∫–±–æ–∫—Å
            if (e.target.type === 'checkbox') return;
            
            const checkbox = this.querySelector('.account-checkbox');
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
                const id = checkbox.dataset.accountId;
                if (checkbox.checked) {
                    selectedAccounts.add(id);
                } else {
                    selectedAccounts.delete(id);
                }
                updateSelectedAccountsCount();
            }
        });
    });
}


function getMaxSpintaxVariants(text) {
    if (!text) return 1;
    
    let maxVariants = 1;
    const spintaxRegex = /\{([^{}]+?)\}/g;
    let match;
    
    while ((match = spintaxRegex.exec(text)) !== null) {
        const options = match[1].split('|');
        maxVariants = Math.max(maxVariants, options.length);
    }
    
    return maxVariants;
}

function updateAccountsCount(){
    const total = allAccounts.length;
    const displayed = document.querySelectorAll('#accounts-table-modal tbody tr').length;
    const el = document.getElementById('accounts-count-label-modal');
    if (el) el.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: ${displayed} / ${total}`;
}

// –¢–æ–≥–≥–ª—ã —Å–µ–∫—Ü–∏–π
function toggleSection(headerId, contentId) {
    const content = document.getElementById(contentId);
    const header = document.getElementById(headerId);
    const chevron = header?.querySelector('.collapse-chevron');
    if (!content || !header || !chevron) return;
    content.classList.toggle('show');
    header.classList.toggle('collapsed');
    chevron.classList.toggle('rotated');
}

// –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ü–µ–ª–∏ —Ä–µ–∫–ª–∞–º—ã
function updateAdGoalSettings() {
    const goal = document.getElementById('adGoal').value;
    const linkTypeSection = document.getElementById('linkTypeSection');
    const externalLinkSection = document.getElementById('externalLinkSection');
    const internalLinkSection = document.getElementById('internalLinkSection');

    if (goal === 'link_click') {
        linkTypeSection.style.display = 'block';
        const linkType = document.getElementById('linkType').value;
        externalLinkSection.style.display = linkType === 'external' ? 'block' : 'none';
        internalLinkSection.style.display = linkType === 'internal' ? 'block' : 'none';
    } else {
        linkTypeSection.style.display = 'none';
        externalLinkSection.style.display = 'none';
        internalLinkSection.style.display = 'none';
    }
}

// –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ç–∏–ø–∞ —Å—Å—ã–ª–∫–∏
function updateLinkTypeSettings() {
    const goal = document.getElementById('adGoal').value;
    const linkType = document.getElementById('linkType').value;
    const externalLinkSection = document.getElementById('externalLinkSection');
    const internalLinkSection = document.getElementById('internalLinkSection');

    if (goal === 'link_click') {
        externalLinkSection.style.display = linkType === 'external' ? 'block' : 'none';
        internalLinkSection.style.display = linkType === 'internal' ? 'block' : 'none';
    }
}

function nextSpintaxVariant() {
    currentPreviewSeed++;
    updateMessagePreview();
    updatePreviewControls();
}

function prevSpintaxVariant() {
    if (currentPreviewSeed > 0) {
        currentPreviewSeed--;
        updateMessagePreview();
        updatePreviewControls();
    }
}

function resetSpintaxCycle() {
    currentPreviewSeed = 0;
    updateMessagePreview();
    updatePreviewControls();
}

function updatePreviewControls() {
    const title = document.getElementById('previewTitle');
    const prevBtn = document.getElementById('prevPreviewVariant');
    const nextBtn = document.getElementById('nextPreviewVariant');
    const rawText = document.getElementById('dmMessageTextarea').value;
    
    // –ü–æ–ª—É—á–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
    const maxVariants = getMaxSpintaxVariants(rawText);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    title.textContent = `–°–æ–æ–±—â–µ–Ω–∏–µ #${currentPreviewSeed + 1}`;
    
    // –£–ø—Ä–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
    if (currentPreviewSeed <= 0) {
        prevBtn.classList.add('disabled');
        prevBtn.style.pointerEvents = 'none';
    } else {
        prevBtn.classList.remove('disabled');
        prevBtn.style.pointerEvents = 'auto';
    }
    
    // –£–ø—Ä–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ "–í–ø–µ—Ä—ë–¥"
    if (currentPreviewSeed >= maxVariants - 1) {
        nextBtn.classList.add('disabled');
        nextBtn.style.pointerEvents = 'none';
    } else {
        nextBtn.classList.remove('disabled');
        nextBtn.style.pointerEvents = 'auto';
    }
}

document.addEventListener('DOMContentLoaded', function(){
    // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω ---
    document.getElementById('btn-dm-recipients').addEventListener('click', function() {
        openModal('dmRecipientsModal', 'dmRecipients', 'dmRecipientsTextarea', 'lineNumbersDmRecipients', 'dmRecipientsLineCount');
    });
    document.getElementById('btn-dm-message').addEventListener('click', function() {
        openModal('dmMessageModal', 'dmMessage', 'dmMessageTextarea', 'lineNumbersDmMessage', 'dmMessageLineCount');
        updateMessagePreview(); // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é
    });
    
    document.getElementById('btn-dm-attachments').addEventListener('click', function() {
        fetch('/api/open-folder?path=–§–∞–π–ª—ã/–†–∞—Å—Å—ã–ª–∫–∞ –≤ –õ–°/–ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏–π/–§–∞–π–ª—ã')
            .then(response => {
                if (!response.ok) {
                    return response.text().then(errorMessage => {
                        if (typeof showNotification === 'function') {
                            showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏: ' + errorMessage, 'error');
                        } else {
                            alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏: ' + errorMessage);
                        }
                    });
                }
                if (typeof showNotification === 'function') {
                    showNotification('–ü–∞–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞', 'success');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏:', error);
                if (typeof showNotification === 'function') {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏: ' + error.message, 'error');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏: ' + error.message);
                }
            });
    });

    document.getElementById('btn-dm-reports').addEventListener('click', function() {
        fetch('/api/open-folder?path=–§–∞–π–ª—ã/–†–∞—Å—Å—ã–ª–∫–∞ –≤ –õ–°/–û—Ç—á–µ—Ç—ã')
            .then(response => {
                if (!response.ok) {
                    return response.text().then(errorMessage => {
                        if (typeof showNotification === 'function') {
                            showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏: ' + errorMessage, 'error');
                        } else {
                            alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏: ' + errorMessage);
                        }
                    });
                }
                if (typeof showNotification === 'function') {
                    showNotification('–ü–∞–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞', 'success');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏:', error);
                if (typeof showNotification === 'function') {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏: ' + error.message, 'error');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏: ' + error.message);
                }
            });
    });
        document.getElementById('btn-dm-links').addEventListener('click', function() {
        openModal('dmLinksModal', 'dmLinks', 'dmLinksTextarea', 'lineNumbersDmLinks', 'dmLinksLineCount');
    });

    // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω ---
    document.getElementById('closeDmMessageModalBtn').addEventListener('click', function() { 
        closeModal('dmMessageModal', 'dmMessage'); 
    });
        document.getElementById('closeDmRecipientsModalBtn').addEventListener('click', function() { 
        closeModal('dmRecipientsModal', 'dmRecipients'); 
    });
    document.getElementById('closeDmLinksModalBtn').addEventListener('click', function() { 
        closeModal('dmLinksModal', 'dmLinks'); 
    });
    
    
    document.getElementById('saveDmMessageBtn').addEventListener('click', function() { 
        saveList('dmMessage', 'dmMessageTextarea', 'dmMessageModal'); 
    });
    document.getElementById('saveDmLinksBtn').addEventListener('click', function() { 
        saveList('dmLinks', 'dmLinksTextarea', 'dmLinksModal'); 
    });
        document.getElementById('saveDmRecipientsBtn').addEventListener('click', function() { 
        saveList('dmRecipients', 'dmRecipientsTextarea', 'dmRecipientsModal'); 
    });

    const dmTextArea = document.getElementById('dmMessageTextarea');
    const dmLineNumbers = document.getElementById('lineNumbersDmMessage');
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫
    updateLineNumbers('lineNumbersDmMessage', 'dmMessageTextarea');
    
    dmTextArea.addEventListener('scroll', function() {
        dmLineNumbers.scrollTop = this.scrollTop;
    });
    
    dmTextArea.addEventListener('input', function() {
        if (!searchStates.dmMessage.active) {
            neuroSpammerLists.dmMessage = this.value;
        }
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            updateMessagePreview();
            updateLineNumbers('lineNumbersDmMessage', 'dmMessageTextarea');
        }, 300);
    });

     
    dmTextArea.addEventListener('keydown', function(e) {
         if (e.key === 'Enter') {
             setTimeout(() => updateLineNumbers('lineNumbersDmMessage', 'dmMessageTextarea'), 0);
         }
    });
    
    document.getElementById('refreshPreviewBtn').addEventListener('click', updateMessagePreview);
    
    // –°–ª–µ–¥—É—é—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç
    document.getElementById('nextPreviewVariant').addEventListener('click', nextSpintaxVariant);
    
    // –ü—Ä–µ–¥—ã–¥—É—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç (–î–û–ë–ê–í–õ–ï–ù–û)
    document.getElementById('prevPreviewVariant').addEventListener('click', prevSpintaxVariant);
    
    // –°–±—Ä–æ—Å
    document.getElementById('resetPreviewCycle').addEventListener('click', resetSpintaxCycle);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    updatePreviewControls();

    // –ü–æ–∏—Å–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–º)
    const searchInputMsg = document.getElementById('searchInputDmMessage');
    searchInputMsg.addEventListener('input', function() { 
        // –î–ª—è –æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä? 
        // –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è "–ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫" –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞ –∫–∞–∫ –≤ —Å–ø–∏—Å–∫–∞—Ö, 
        // –Ω–æ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª "—Å–∫—Ä—ã—Ç–∏—è" –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–∞–ª–æ–∫.
        // –õ–∏–±–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å performSearch —á—Ç–æ–±—ã –æ–Ω –ø—Ä–æ—Å—Ç–æ –∏—Å–∫–∞–ª –≤ —Ç–µ–∫—Å—Ç–µ (Ctrl+F —Å—Ç–∏–ª—å), –Ω–æ —ç—Ç–æ —Å–ª–æ–∂–Ω–µ–µ.
        // –û—Å—Ç–∞–≤–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ª–æ–≥–∏–∫—É:
        // performSearch('dmMessage'); 
    });
    
    document.getElementById('searchToggleDmMessage').addEventListener('click', function() { toggleSearch('dmMessage'); });
    document.getElementById('clearSearchDmMessage').addEventListener('click', function() { resetSearch('dmMessage'); updateMessagePreview(); });
    document.getElementById('closeRecipientsModalBtn').addEventListener('click', function() { closeModal('recipientsModal', 'recipients'); });
    document.getElementById('closeProductDescriptionModalBtn').addEventListener('click', function() { closeModal('productDescriptionModal', 'productDescription'); });
    document.getElementById('closeDialogScriptingModalBtn').addEventListener('click', function() { closeModal('dialogScriptingModal', 'dialogScripting'); });
    document.getElementById('closeGreetingModalBtn').addEventListener('click', function() { closeModal('greetingModal', 'greeting'); });
    document.getElementById('closeArgumentsModalBtn').addEventListener('click', function() { closeModal('argumentsModal', 'arguments'); });
    document.getElementById('closeSlangModalBtn').addEventListener('click', function() { closeModal('slangModal', 'slang'); });
    document.getElementById('closeExcludeModalBtn').addEventListener('click', function() { closeModal('excludeModal', 'exclude'); });

    // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ---
    document.getElementById('saveRecipientsBtn').addEventListener('click', function() { saveList('recipients', 'recipientsTextarea', 'recipientsModal'); });
    document.getElementById('saveProductDescriptionBtn').addEventListener('click', function() { saveList('productDescription', 'productDescriptionTextarea', 'productDescriptionModal'); });
    document.getElementById('saveDialogScriptingBtn').addEventListener('click', function() { saveList('dialogScripting', 'dialogScriptingTextarea', 'dialogScriptingModal'); });
    document.getElementById('saveGreetingBtn').addEventListener('click', function() { saveList('greeting', 'greetingTextarea', 'greetingModal'); });
    document.getElementById('saveArgumentsBtn').addEventListener('click', function() { saveList('arguments', 'argumentsTextarea', 'argumentsModal'); });
    document.getElementById('saveSlangBtn').addEventListener('click', function() { saveList('slang', 'slangTextarea', 'slangModal'); });
    document.getElementById('saveExcludeBtn').addEventListener('click', function() { saveList('exclude', 'excludeTextarea', 'excludeModal'); });

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è ---
    const textareas = [
        { id: 'recipientsTextarea', lineNumbersId: 'lineNumbersRecipients', listKey: 'recipients', counterId: 'counter-recipients' },
        { id: 'productDescriptionTextarea', lineNumbersId: 'lineNumbersProductDescription', listKey: 'productDescription' },
        { id: 'dialogScriptingTextarea', lineNumbersId: 'lineNumbersDialogScripting', listKey: 'dialogScripting' },
        { id: 'greetingTextarea', lineNumbersId: 'lineNumbersGreeting', listKey: 'greeting' },
        { id: 'argumentsTextarea', lineNumbersId: 'lineNumbersArguments', listKey: 'arguments' },
        { id: 'slangTextarea', lineNumbersId: 'lineNumbersSlang', listKey: 'slang' },
        { id: 'excludeTextarea', lineNumbersId: 'lineNumbersExclude', listKey: 'exclude' },
        { id: 'dmRecipientsTextarea', lineNumbersId: 'lineNumbersDmRecipients', listKey: 'dmRecipients' },
        { id: 'dmLinksTextarea', lineNumbersId: 'lineNumbersDmLinks', listKey: 'dmLinks' }
    ];

    textareas.forEach(item => {
        const textarea = document.getElementById(item.id);
        const lineNumbers = document.getElementById(item.lineNumbersId);

        updateLineNumbers(item.lineNumbersId, item.id);

        textarea.addEventListener('scroll', function() {
            lineNumbers.scrollTop = this.scrollTop;
        });

        textarea.addEventListener('input', function() {
            if (!searchStates[item.listKey].active || document.getElementById(`searchInput${item.listKey.charAt(0).toUpperCase() + item.listKey.slice(1)}`).value.trim() === '') {
                if (Array.isArray(neuroSpammerLists[item.listKey])) {
                    neuroSpammerLists[item.listKey] = textarea.value.split('\n');
                } else {
                    neuroSpammerLists[item.listKey] = textarea.value;
                }
            }
            updateLineCount(`${item.listKey}LineCount`, item.id, item.listKey);
        });

        textarea.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                setTimeout(() => updateLineNumbers(item.lineNumbersId, item.id), 0);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–∏—Å–∫–∞
        const searchInput = document.getElementById(`searchInput${item.listKey.charAt(0).toUpperCase() + item.listKey.slice(1)}`);
        searchInput.addEventListener('input', function() { performSearch(item.listKey); });
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideSearch(item.listKey);
            }
        });

        const clearSearchBtn = document.getElementById(`clearSearch${item.listKey.charAt(0).toUpperCase() + item.listKey.slice(1)}`);
        clearSearchBtn.addEventListener('click', function() { resetSearch(item.listKey); });

        const searchToggleBtn = document.getElementById(`searchToggle${item.listKey.charAt(0).toUpperCase() + item.listKey.slice(1)}`);
        searchToggleBtn.addEventListener('click', function() { toggleSearch(item.listKey); });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –æ–≤–µ—Ä–ª–µ—é
        const overlay = document.querySelector(`#${item.listKey.charAt(0).toUpperCase() + item.listKey.slice(1)}Modal .neuro-spammer-modal-overlay`);
        if (overlay) {
            overlay.addEventListener('click', function() { closeModal(`${item.listKey.charAt(0).toUpperCase() + item.listKey.slice(1)}Modal`, item.listKey); });
        }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    updateLineCount('recipientsLineCount', 'recipientsTextarea', 'recipients');
    updateLineCount('productDescriptionLineCount', 'productDescriptionTextarea', 'productDescription');
    updateLineCount('dialogScriptingLineCount', 'dialogScriptingTextarea', 'dialogScripting');
    updateLineCount('greetingLineCount', 'greetingTextarea', 'greeting');
    updateLineCount('argumentsLineCount', 'argumentsTextarea', 'arguments');
    updateLineCount('slangLineCount', 'slangTextarea', 'slang');
    updateLineCount('excludeLineCount', 'excludeTextarea', 'exclude');

    // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞
    document.getElementById('start-spammer-btn').addEventListener('click', function(){ showModal('spammerTaskModal'); });
    document.getElementById('spammerTaskModal').addEventListener('click', function(e){ if (e.target === this) hideModal('spammerTaskModal'); });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–∞—Å—Å—ã–ª–∫–∏ –≤ –õ–°
    const startDmBtn = document.getElementById('start-dm-btn');
    const doStartDmBtn = document.getElementById('do-start-dm-btn');
    const sendButton = document.getElementById('send-button');
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ start-dm-btn, –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –Ω–µ–π —Ñ—É–Ω–∫—Ü–∏—é
    if (startDmBtn) {
        startDmBtn.addEventListener('click', function() {
            if (typeof startPMMailing === 'function') {
                startPMMailing();
            } else {
                console.error('–§—É–Ω–∫—Ü–∏—è startPMMailing –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                alert('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        });
    }
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ do-start-dm-btn –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    if (doStartDmBtn) {
        doStartDmBtn.addEventListener('click', function() {
            const modal = document.getElementById('dmTaskModal');
            if (modal) {
                modal.style.display = 'none';
            }
            if (typeof startPMMailing === 'function') {
                startPMMailing();
            } else {
                console.error('–§—É–Ω–∫—Ü–∏—è startPMMailing –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                alert('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        });
    }
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ send-button (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
    if (sendButton && !startDmBtn) {
        sendButton.addEventListener('click', function() {
            if (typeof startPMMailing === 'function') {
                startPMMailing();
            }
        });
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –≤—ã–±–æ—Ä–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
    document.getElementById('select-accounts-btn').addEventListener('click', function(){
        hideModal('spammerTaskModal');
        showModal('accountsModal');
        loadAccounts();
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
    document.getElementById('accountsModalClose').addEventListener('click', () => hideModal('accountsModal'));
    document.getElementById('accountsModalCancel').addEventListener('click', () => hideModal('accountsModal'));
    document.getElementById('accountsModal').addEventListener('click', function(e){ if (e.target === this) hideModal('accountsModal'); });
    document.getElementById('confirmAccountsSelection').addEventListener('click', function(){ hideModal('accountsModal'); showModal('spammerTaskModal'); });

    // –°–µ–ª–µ–∫—Ç—ã –ø–∞–ø–æ–∫ –∏ —Å–ø–∞–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
    document.getElementById('all-folder-accounts')?.addEventListener('click', () => { currentFolder='all'; loadAccounts('all'); });
    document.getElementById('working-folder-accounts')?.addEventListener('click', () => { currentFolder='working'; loadAccounts('working'); });
    document.getElementById('archive-folder-accounts')?.addEventListener('click', () => { currentFolder='archive'; loadAccounts('archive'); });
    document.getElementById('no-spam-folder-accounts')?.addEventListener('click', () => { currentSpamFilter='no-spam'; loadAccounts(currentFolder); });
    document.getElementById('with-spam-folder-accounts')?.addEventListener('click', () => { currentSpamFilter='with-spam'; loadAccounts(currentFolder); });

    // –í—ã–¥–µ–ª–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è
    document.getElementById('select-all-accounts-modal').addEventListener('click', selectAllAccountsInModal);
    document.getElementById('deselect-all-btn-modal').addEventListener('click', deselectAllAccountsInModal);
    const selectAllCheckbox = document.getElementById('select-all-checkbox-modal');
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function(){ this.checked ? selectAllAccountsInModal() : deselectAllAccountsInModal(); });
    }

    // –¢–æ–≥–≥–ª—ã —Å–µ–∫—Ü–∏–π
    document.getElementById('additionalSettingsHeader')?.addEventListener('click', () => toggleSection('additionalSettingsHeader','additionalSettingsOptions'));
    document.getElementById('noOverlapHeader')?.addEventListener('click', () => toggleSection('noOverlapHeader','noOverlapOptions'));
    document.getElementById('contactsHeader')?.addEventListener('click', () => toggleSection('contactsHeader','contactsOptions'));
    document.getElementById('storiesHeader')?.addEventListener('click', () => toggleSection('storiesHeader','storiesOptions'));
    document.getElementById('secretChatsHeader')?.addEventListener('click', () => toggleSection('secretChatsHeader','secretChatsOptions'));
    document.getElementById('imageUniqHeader')?.addEventListener('click', () => toggleSection('imageUniqHeader','imageUniqOptions'));
    document.getElementById('extraOptionsHeader')?.addEventListener('click', () => toggleSection('extraOptionsHeader','extraOptions'));

    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–ª–∏ —Ä–µ–∫–ª–∞–º—ã
    document.getElementById('adGoal').addEventListener('change', updateAdGoalSettings);
    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—Å—ã–ª–∫–∏
    document.getElementById('linkType').addEventListener('change', updateLinkTypeSettings);
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    updateAdGoalSettings();

    // –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏
    document.getElementById('do-start-spammer-btn').addEventListener('click', function(){
        const threadCount = parseInt(document.getElementById('threadCount').value, 10);
        const selectedAccountIds = Array.from(selectedAccounts);

        if (!selectedAccountIds.length) { 
            if (typeof showNotification === 'function') {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏', 'warning');
            } else {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏');
            }
            return; 
        }
        if (!threadCount || threadCount < 1 || threadCount > 50) { 
            if (typeof showNotification === 'function') {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ (1-50)', 'warning');
            } else {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ (1-50)');
            }
            return; 
        }

        const delay = parseInt(document.getElementById('delayBetweenMessages').value, 10);
        const totalLimit = parseInt(document.getElementById('totalMessageLimit').value, 10);
        const accountLimit = parseInt(document.getElementById('accountMessageLimit').value, 10);
        const allowLinkPreview = document.getElementById('allowLinkPreview').value === 'true';

        if (isNaN(delay) || delay < 1) { alert('–ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º'); return; }
        if (isNaN(totalLimit) || totalLimit < 0) { alert('–û–±—â–∏–π –ª–∏–º–∏—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º'); return; }
        if (isNaN(accountLimit) || accountLimit < 0) { alert('–õ–∏–º–∏—Ç —Å –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º'); return; }

        const settings = {
            delayBetweenMessages: delay,
            totalMessageLimit: totalLimit,
            accountMessageLimit: accountLimit,
            adGoal: document.getElementById('adGoal').value,
            allowLinkPreview: allowLinkPreview,
            lists: neuroSpammerLists
        };

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Å—ã–ª–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ü–µ–ª–∏
        if (settings.adGoal === 'link_click') {
            settings.linkType = document.getElementById('linkType').value;
            if (settings.linkType === 'external') {
                settings.externalLink = document.getElementById('externalLink').value;
            } else { // internal
                settings.internalLinkTarget = document.getElementById('internalLinkTarget').value;
                settings.internalLink = document.getElementById('internalLink').value;
            }
        }

        fetch('/start_neuro_spammer_task', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ account_ids: selectedAccountIds, thread_count: threadCount, settings })
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                if (typeof showNotification === 'function') {
                    showNotification('–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!', 'success');
                } else {
                alert('–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!');
                }
                hideModal('spammerTaskModal');
                selectedAccounts.clear();
                updateSelectedAccountsCount();
            } else {
                if (typeof showNotification === 'function') {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
            } else {
                alert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
            }
        })
        .catch(err => { 
            console.error(err); 
            if (typeof showNotification === 'function') {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ: ' + err.message, 'error');
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ: ' + err.message);
            }
        });
    });

    // –õ–µ–≥–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
    setTimeout(() => { document.getElementById('start-spammer-btn').classList.add('pulse'); }, 1000);
});

// –¢—É–ª—Ç–∏–ø—ã
document.addEventListener('mouseover', function(e){
    if (e.target.closest('[data-tooltip]')) {
        const t = e.target.closest('[data-tooltip]').getAttribute('data-tooltip');
        const el = document.getElementById('customTooltip');
        el.textContent = t; el.style.left = (e.pageX+2)+'px'; el.style.top = (e.pageY-4)+'px'; el.classList.add('show');
    }
});
document.addEventListener('mouseout', function(e){ if (e.target.closest('[data-tooltip]')) document.getElementById('customTooltip').classList.remove('show'); });
</script>
{% endblock %}


