{% extends "base.html" %}
{% block title %}–†–∞—Å—Å—ã–ª–∫–∞ –ø–æ —á–∞—Ç–∞–º{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile_edit.css') }}">
{% endblock %}

{% block content %}
<div class="proxy-page">
    <h1 class="page-title">–†–∞—Å—Å—ã–ª–∫–∞ –ø–æ —á–∞—Ç–∞–º</h1>

    <!-- –ö–Ω–æ–ø–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤/—Ñ–∞–π–ª–æ–≤ -->
    <div class="card">
        <div class="card-body">
            <div class="file-buttons-container">
                <button class="btn btn-light" id="btn-chat-recipients">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg>
                    C–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
                    <span class="section-button-counter ms-1" id="recipients-counter">0</span>
                </button>
                <button class="btn btn-light" id="btn-chat-message">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                    </svg>
                    –°–æ–æ–±—â–µ–Ω–∏–µ
                </button>
                <button class="btn btn-light" id="btn-chat-attachments">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                        <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                        <circle cx="10" cy="12" r="2"></circle>
                        <path d="m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"></path>
                    </svg>
                    –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
                    <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã, –∫ –∫–∞–∂–¥–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–π –∏–∑ —Å–ø–∏—Å–∫–∞. –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ –∏ –∫—Ä—É–∂–æ—á–∫–∏ ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <path d="M12 17h.01"></path>
                        </svg>
                    </span>
                </button>
                <button class="btn btn-light" id="btn-chat-links">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                    –°—Å—ã–ª–∫–∏
                    <span class="help-icon" data-tooltip="–ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –ø—Ä—è–º–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–º–µ–Ω—ã.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <path d="M12 17h.01"></path>
                        </svg>
                    </span>
                </button>
                <button class="btn btn-light" id="btn-chat-reports">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1 lucide">
                        <rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect>
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                        <path d="m9 14 2 2 4-4"></path>
                    </svg>
                    –û—Ç—á—ë—Ç—ã
                </button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –ª–∏–º–∏—Ç—ã) -->
    <div class="card">
        <div class="card-body">
            <div class="options-container">
                <div>
                    <label for="delayBetweenSends" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ —Å –∞–∫–∫–∞—É–Ω—Ç–∞</label>
                    <span class="help-icon" data-tooltip="–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä: 5-20.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                    </span>
                    <div class="input-group" style="max-width: 200px">
                        <input class="form-control has-trailing-label" id="delayBetweenSends" value="0">
                        <span class="input-trailing-label">—Å–µ–∫</span>
                        <div class="invalid-feedback" id="invalid-feedback-for-delayBetweenSends"></div>
                    </div>
                </div>
                <div>
                    <label for="totalSendsLimit" class="form-label">–û–±—â–∏–π –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</label>
                    <span class="help-icon" data-tooltip="–õ–∏–º–∏—Ç —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫ —Å–æ –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Å—É–º–º–∞—Ä–Ω–æ.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                    </span>
                    <div class="input-group" style="max-width: 200px">
                        <input class="form-control rounded-end" id="totalSendsLimit" placeholder="–û—Ç–∫–ª—é—á–µ–Ω–æ">
                        <div class="invalid-feedback" id="invalid-feedback-for-totalSendsLimit"></div>
                    </div>
                </div>
                <div>
                    <label for="perAccountSendsLimit" class="form-label">–õ–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∞–∫–∫–∞—É–Ω—Ç–∞</label>
                    <div class="input-group" style="max-width: 200px">
                        <input class="form-control rounded-end" id="perAccountSendsLimit" value="50">
                        <div class="invalid-feedback" id="invalid-feedback-for-perAccountSendsLimit"></div>
                    </div>
                </div>
                <div>
                    <label for="spamBlockErrorsToSkip" class="form-label">–°–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ —Å–ø–∞–º–±–ª–æ–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å</label>
                    <span class="help-icon" data-tooltip="–¢–µ–ª–µ–≥—Ä–∞–º –º–æ–∂–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å–ø–∞–º–±–ª–æ–∫–∞. –£–∫–∞–∂–∏—Ç–µ, —Å–∫–æ–ª—å–∫–æ —Ç–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–∂–¥–µ —á–µ–º —Å—á–∏—Ç–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                    </span>
                    <div class="input-group" style="max-width: 200px">
                        <input class="form-control rounded-end" id="spamBlockErrorsToSkip" value="5">
                        <div class="invalid-feedback" id="invalid-feedback-for-spamBlockErrorsToSkip"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ -->
    <div class="card">
        <div class="card-body">
            <h3 class="subsection-title subsection-title-collapse collapsed" id="extraOptionsHeader">
                –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
                <svg class="svg-icon collapse-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4px" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"></path></svg>
            </h3>
            <div class="collapse" id="extraOptions">
                <div class="options-container">
                    <div>
                        <label for="allowLinkPreview" class="form-label">–†–∞–∑—Ä–µ—à–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Å—ã–ª–æ–∫</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞, –¢–µ–ª–µ–≥—Ä–∞–º –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä. –û—Ç–∫–ª—é—á–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="allowLinkPreview">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-allowLinkPreview"></div>
                        </div>
                    </div>
                    <div>
                        <label for="markSpamBlockInDb" class="form-label">–°—Ç–∞–≤–∏—Ç—å –º–µ—Ç–∫—É "–°–ø–∞–º–±–ª–æ–∫" –≤ –±–∞–∑–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</label>
                        <span class="help-icon" data-tooltip="–ü–æ–º–µ—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—É—á–µ–Ω—ã –æ—à–∏–±–∫–∏ —Å–ø–∞–º–±–ª–æ–∫–∞, —á—Ç–æ–±—ã –Ω–µ –±—Ä–∞—Ç—å –∏—Ö –≤ —Ä–∞–±–æ—Ç—É –ø–æ–∑–∂–µ.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="markSpamBlockInDb">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-markSpamBlockInDb"></div>
                        </div>
                    </div>
                    <div>
                        <label for="maxAllowedDelay" class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –¢–µ–ª–µ–≥—Ä–∞–º –≤—ã–¥–∞—Å—Ç –∑–∞–¥–µ—Ä–∂–∫—É –±–æ–ª—å—à–µ —É–∫–∞–∑–∞–Ω–Ω–æ–π, –∞–∫–∫–∞—É–Ω—Ç –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É. –ï—Å–ª–∏ –º–µ–Ω—å—à–µ ‚Äî –ø–æ–¥–æ–∂–¥—ë—Ç –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control has-trailing-label" id="maxAllowedDelay" value="800">
                            <span class="input-trailing-label">—Å–µ–∫</span>
                            <div class="invalid-feedback" id="invalid-feedback-for-maxAllowedDelay"></div>
                        </div>
                    </div>
                    <div>
                        <label for="hideMediaWithSpoiler" class="form-label">–°–∫—Ä—ã–≤–∞—Ç—å –º–µ–¥–∏–∞ –ø–æ–¥ —Å–ø–æ–π–ª–µ—Ä–æ–º</label>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="hideMediaWithSpoiler">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-hideMediaWithSpoiler"></div>
                        </div>
                    </div>
                    <div>
                        <label for="sendSilently" class="form-label">–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –±–µ–∑ –∑–≤—É–∫–∞</label>
                        <span class="help-icon" data-tooltip="–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –ï—Å–ª–∏ —Ç–µ–ª–µ–≥—Ä–∞–º –æ—Ç–∫—Ä—ã—Ç ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="sendSilently">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-sendSilently"></div>
                        </div>
                    </div>
                    <div>
                        <label for="pinAfterSend" class="form-label">–ó–∞–∫—Ä–µ–ø–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
                        <div class="input-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="pinAfterSend">
                            </div>
                            <div class="invalid-feedback" id="invalid-feedback-for-pinAfterSend"></div>
                        </div>
                    </div>
                    <div>
                        <label for="maxConsecutiveSpamBlocks" class="form-label">–ú–∞–∫—Å–∏–º—É–º —Å–ø–∞–º–±–ª–æ–∫–æ–≤ –ø–æ–¥—Ä—è–¥</label>
                        <span class="help-icon" data-tooltip="–ü—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å: –µ—Å–ª–∏ –ø–æ–¥—Ä—è–¥ –º–Ω–æ–≥–æ —Å–ø–∞–º–±–ª–æ–∫–æ–≤ —Å 0 –æ—Ç–ø—Ä–∞–≤–æ–∫ ‚Äî —Ä–∞—Å—Å—ã–ª–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.">
                            <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                        </span>
                        <div class="input-group" style="max-width: 200px">
                            <input class="form-control rounded-end" id="maxConsecutiveSpamBlocks" value="30">
                            <div class="invalid-feedback" id="invalid-feedback-for-maxConsecutiveSpamBlocks"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ -->
<div class="start-task-btn-group">
    <button type="button" class="start-task-btn" id="start-chat-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg>
        –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
    </button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞–ø—É—Å–∫–∞ -->
<div class="modal" id="chatTaskModal">
    <div class="modal-content">
        <div class="modal-body">
            <div class="options-container">
                <div class="mb-4">
                    <button class="btn btn-primary w-100" id="select-accounts-btn">
                        <span>–ê–∫–∫–∞—É–Ω—Ç—ã</span>
                        <span class="mx-1 opacity-50">|</span>
                        <span id="accounts-picked-for-task-count">0</span>
                    </button>
                </div>
                <div>
                    <label for="threadCount" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤</label>
                    <span class="help-icon ms-1" data-tooltip="–°–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.">
                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <path d="M12 17h.01"></path>
                            </svg>
                    </span>
                    <div class="input-group">
                        <input class="form-control" id="threadCount" type="number" min="1" max="50" value="1">
                        <div class="invalid-feedback" id="invalid-feedback-for-threadCount"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary btn-lg" id="do-start-chat-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path></svg>
                <span>–ó–∞–ø—É—Å—Ç–∏—Ç—å</span>
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ -->
<div class="modal" id="accountsModal" style="display: none;">
    <div class="modal-content" style="width: 90%; max-width: 1200px; height: 80vh;">
        <div class="modal-header">
            <h5 class="modal-title">–í—ã–±–æ—Ä –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h5>
            <button type="button" class="modal-close" id="accountsModalClose">&times;</button>
        </div>
        <div class="modal-body" style="height: calc(100% - 120px); overflow: hidden;">
            <div class="proxy-container" style="height: 100%;">
                <div class="header-section">
                    <div class="table-controls">
                        <div class="account-folder-selector">
                            <button class="account-folder-btn active" id="all-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã</div>
                                <div class="active-indicator"></div>
                            </button>
                            <button class="account-folder-btn" id="working-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–î–ª—è —Ä–∞–±–æ—Ç—ã</div>
                                <div class="active-indicator"></div>
                            </button>
                            <button class="account-folder-btn" id="archive-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–ê—Ä—Ö–∏–≤</div>
                                <div class="active-indicator"></div>
                            </button>
                            <button class="account-folder-btn" id="no-spam-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–ë–µ–∑ —Å–ø–∞–º–±–ª–æ–∫–∞</div>
                                <div class="active-indicator"></div>
                            </button>
                            <button class="account-folder-btn" id="with-spam-folder-accounts">
                                <div class="account-count" data-count="0">0</div>
                                <div class="account-label">–°–ø–∞–º–±–ª–æ–∫</div>
                                <div class="active-indicator"></div>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-body p-3 d-flex align-items-center">
                        <div class="d-flex gap-2">
                            <button class="btn btn-light" id="select-all-accounts-modal">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 7 17l-5-5"></path><path d="m22 10-7.5 7.5L13 16"></path></svg>
                            </button>
                            <button id="deselect-all-btn-modal" type="button" class="btn btn-light">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                            </button>
                        </div>
                        <span class="text-muted ms-auto" id="accounts-count-label-modal">–ü–æ–∫–∞–∑–∞–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: 0 / 0</span>
                    </div>
                </div>

                <div style="height: calc(100% - 200px); overflow-y: auto;">
                    <table id="accounts-table-modal" class="proxy-table">
                        <thead>
                            <tr>
                                <th class="selector-header"><input type="checkbox" id="select-all-checkbox-modal" class="select-all-checkbox"></th>
                                <th>#</th>
                                <th>–ê–≤–∞—Ç–∞—Ä</th>
                                <th><div class="sortable-header" data-sort="phone">–¢–µ–ª–µ—Ñ–æ–Ω<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                                <th><div class="sortable-header" data-sort="geo">–ì–µ–æ<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                                <th><div class="sortable-header" data-sort="status">–°—Ç–∞—Ç—É—Å<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                                <th>–û—Ç–ª–µ–∂–∫–∞</th>
                                <th><div class="sortable-header" data-sort="role">–†–æ–ª—å<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                                <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω</th>
                                <th><div class="sortable-header" data-sort="name">–ò–º—è<div class="sort-icons"><span class="sort-asc">‚ñ≤</span><span class="sort-desc">‚ñº</span></div></div></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="accountsModalCancel">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn btn-primary" id="confirmAccountsSelection">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å (<span id="selected-count-modal">0</span>)</button>
        </div>
    </div>
</div>

<div id="customTooltip" class="custom-tooltip"></div>

<script>
// –†–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â—É—é –ª–æ–≥–∏–∫—É –º–æ–¥–∞–ª–æ–∫ –∏ —Ç–∞–±–ª–∏—Ü—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –∫–∞–∫ –≤ parsing
let selectedAccounts = new Set();
let allAccounts = [];
let currentFolder = 'all';
let currentSpamFilter = null;

function showModal(modalId) {
    document.getElementById(modalId).classList.add('show');
    document.getElementById(modalId).style.display = 'block';
}
function hideModal(modalId) {
    document.getElementById(modalId).classList.remove('show');
    setTimeout(() => { document.getElementById(modalId).style.display = 'none'; }, 1);
}

function updateSelectedAccountsCount() {
    const el = document.getElementById('accounts-picked-for-task-count');
    if (el) el.textContent = selectedAccounts.size;
    const el2 = document.getElementById('selected-count-modal');
    if (el2) el2.textContent = selectedAccounts.size;
}

function selectAllAccountsInModal() {
    document.querySelectorAll('.account-checkbox').forEach(checkbox => {
        const accountId = checkbox.getAttribute('data-account-id');
        selectedAccounts.add(accountId);
        checkbox.checked = true;
    });
    updateSelectedAccountsCount();
}
function deselectAllAccountsInModal() {
    selectedAccounts.clear();
    document.querySelectorAll('.account-checkbox').forEach(checkbox => { checkbox.checked = false; });
    updateSelectedAccountsCount();
}

async function loadAccounts(folder = 'all') {
    try {
        const response = await fetch('/get_accounts', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ folder }) });
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤');
        allAccounts = await response.json();
        renderAccountsTable();
        updateAccountsCount();
    } catch (e) { console.error(e); }
}

function getStatusClass(status) {
    switch (status) {
        case 'alive': return 'alive';
        case 'dead': return 'dead';
        case 'spam_block': return 'spam-block';
        default: return 'unknown';
    }
}
function getStatusText(status) {
    switch (status) {
        case 'alive': return '–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π';
        case 'dead': return '–ú–µ—Ä—Ç–≤';
        case 'spam_block': return '–°–ø–∞–º –±–ª–æ–∫';
        default: return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
    }
}
function getCountryData(){ return { RU:{name:'–†–æ—Å—Å–∏—è'}, UA:{name:'–£–∫—Ä–∞–∏–Ω–∞'}, KZ:{name:'–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω'}, US:{name:'–°–®–ê'} }; }
function getCountryInfo(code){ const m=getCountryData(); return m[code]||{name:code||'–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}; }
function getFlagEmoji(code){ if(!code) return 'üè≥Ô∏è'; const cps=code.toUpperCase().split('').map(c=>127397+c.charCodeAt(0)); try{ return String.fromCodePoint(...cps);}catch(e){return 'üè≥Ô∏è';}}

function renderAccountsTable() {
    const tbody = document.querySelector('#accounts-table-modal tbody');
    if (!tbody) return;
    tbody.innerHTML = (allAccounts || []).map((account, index) => {
        const fullName = `${account.first_name || ''} ${account.last_name || ''}`.trim();
        const countryInfo = getCountryInfo(account.geo);
        const flagEmoji = getFlagEmoji(account.geo);
        return `
            <tr data-account-id="${account.id}" class="account-row">
                <td><input type="checkbox" class="account-checkbox" data-account-id="${account.id}" ${selectedAccounts.has(account.id) ? 'checked' : ''}></td>
                <td>${index + 1}</td>
                <td class="avatar-cell"><div class="avatar-placeholder">${(account.first_name||account.last_name||'?').toString().charAt(0).toUpperCase()}</div></td>
                <td>${account.phone || ''}</td>
                <td><div class="geo-cell" title="${countryInfo.name}"><span class="country-flag">${flagEmoji}</span><span class="country-code">${account.geo||''}</span></div></td>
                <td><span class="status-badge ${getStatusClass(account.status)}">${getStatusText(account.status)}</span></td>
                <td class="rest-period" data="${account.register_time}">${account.rest_until || '-'}</td>
                <td>${account.role || ''}</td>
                <td>${account.last_used || '–ù–µ—Ç'}</td>
                <td>${fullName || ''}</td>
            </tr>
        `;
    }).join('');

    document.querySelectorAll('.account-checkbox').forEach(cb => {
        cb.addEventListener('change', function(){
            const id = this.dataset.accountId;
            if (this.checked) selectedAccounts.add(id); else selectedAccounts.delete(id);
            updateSelectedAccountsCount();
        });
    });
}

function updateAccountsCount(){
    const total = allAccounts.length;
    const displayed = document.querySelectorAll('#accounts-table-modal tbody tr').length;
    const el = document.getElementById('accounts-count-label-modal');
    if (el) el.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: ${displayed} / ${total}`;
}

// –¢–æ–≥–≥–ª—ã —Å–µ–∫—Ü–∏–π
function toggleSection(headerId, contentId) {
    const content = document.getElementById(contentId);
    const header = document.getElementById(headerId);
    const chevron = header?.querySelector('.collapse-chevron');
    if (!content || !header || !chevron) return;
    content.classList.toggle('show');
    header.classList.toggle('collapsed');
    chevron.classList.toggle('rotated');
}

document.addEventListener('DOMContentLoaded', function(){
    // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞
    document.getElementById('start-chat-btn').addEventListener('click', function(){ showModal('chatTaskModal'); });
    document.getElementById('chatTaskModal').addEventListener('click', function(e){ if (e.target === this) hideModal('chatTaskModal'); });

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –≤—ã–±–æ—Ä–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
    document.getElementById('select-accounts-btn').addEventListener('click', function(){
        hideModal('chatTaskModal');
        showModal('accountsModal');
        loadAccounts();
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
    document.getElementById('accountsModalClose').addEventListener('click', () => hideModal('accountsModal'));
    document.getElementById('accountsModalCancel').addEventListener('click', () => hideModal('accountsModal'));
    document.getElementById('accountsModal').addEventListener('click', function(e){ if (e.target === this) hideModal('accountsModal'); });
    document.getElementById('confirmAccountsSelection').addEventListener('click', function(){ hideModal('accountsModal'); showModal('chatTaskModal'); });

    // –°–µ–ª–µ–∫—Ç—ã –ø–∞–ø–æ–∫ –∏ —Å–ø–∞–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
    document.getElementById('all-folder-accounts')?.addEventListener('click', () => { currentFolder='all'; loadAccounts('all'); });
    document.getElementById('working-folder-accounts')?.addEventListener('click', () => { currentFolder='working'; loadAccounts('working'); });
    document.getElementById('archive-folder-accounts')?.addEventListener('click', () => { currentFolder='archive'; loadAccounts('archive'); });
    document.getElementById('no-spam-folder-accounts')?.addEventListener('click', () => { currentSpamFilter='no-spam'; loadAccounts(currentFolder); });
    document.getElementById('with-spam-folder-accounts')?.addEventListener('click', () => { currentSpamFilter='with-spam'; loadAccounts(currentFolder); });

    // –í—ã–¥–µ–ª–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è
    document.getElementById('select-all-accounts-modal').addEventListener('click', selectAllAccountsInModal);
    document.getElementById('deselect-all-btn-modal').addEventListener('click', deselectAllAccountsInModal);
    const selectAllCheckbox = document.getElementById('select-all-checkbox-modal');
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function(){ this.checked ? selectAllAccountsInModal() : deselectAllAccountsInModal(); });
    }

    // –¢–æ–≥–≥–ª –æ—Å—Ç–∞–≤—à–µ–π—Å—è —Å–µ–∫—Ü–∏–∏
    document.getElementById('extraOptionsHeader').addEventListener('click', () => toggleSection('extraOptionsHeader','extraOptions'));

    // –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏
    document.getElementById('do-start-chat-btn').addEventListener('click', function(){
        const threadCount = parseInt(document.getElementById('threadCount').value, 10);
        const selectedAccountIds = Array.from(selectedAccounts);
        if (!selectedAccountIds.length) { 
            if (typeof showNotification === 'function') {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏', 'warning');
            } else {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏');
            }
            return; 
        }
        if (!threadCount || threadCount < 1 || threadCount > 50) { 
            if (typeof showNotification === 'function') {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ (1-50)', 'warning');
            } else {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ (1-50)');
            }
            return; 
        }

        const settings = {
            base: {
                delayBetweenSends: document.getElementById('delayBetweenSends').value.trim(),
                totalSendsLimit: document.getElementById('totalSendsLimit').value.trim(),
                perAccountSendsLimit: parseInt(document.getElementById('perAccountSendsLimit').value || '0', 10),
                spamBlockErrorsToSkip: parseInt(document.getElementById('spamBlockErrorsToSkip').value || '0', 10)
            },
            extra: {
                allowLinkPreview: document.getElementById('allowLinkPreview').checked,
                markSpamBlockInDb: document.getElementById('markSpamBlockInDb').checked,
                maxAllowedDelaySec: parseInt(document.getElementById('maxAllowedDelay').value || '0', 10),
                hideMediaWithSpoiler: document.getElementById('hideMediaWithSpoiler').checked,
                sendSilently: document.getElementById('sendSilently').checked,
                pinAfterSend: document.getElementById('pinAfterSend').checked,
                maxConsecutiveSpamBlocks: parseInt(document.getElementById('maxConsecutiveSpamBlocks').value || '0', 10)
            }
        };

        fetch('/start_chat_spammer_task', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ account_ids: selectedAccountIds, thread_count: threadCount, settings })
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                if (typeof showNotification === 'function') {
                    showNotification('–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!', 'success');
                } else {
                alert('–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!');
                }
                hideModal('chatTaskModal');
                selectedAccounts.clear();
                updateSelectedAccountsCount();
            } else {
                if (typeof showNotification === 'function') {
                    showNotification('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
            } else {
                alert('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
            }
        })
        .catch(err => { 
            console.error(err); 
            if (typeof showNotification === 'function') {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ: ' + err.message, 'error');
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ: ' + err.message);
            }
        });
    });

    // –ù–µ–±–æ–ª—å—à–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
    setTimeout(() => { document.getElementById('start-chat-btn').classList.add('pulse'); }, 1000);
});

// –¢—É–ª—Ç–∏–ø—ã
document.addEventListener('mouseover', function(e){
    if (e.target.closest('[data-tooltip]')) {
        const t = e.target.closest('[data-tooltip]').getAttribute('data-tooltip');
        const el = document.getElementById('customTooltip');
        el.textContent = t; el.style.left = (e.pageX+2)+'px'; el.style.top = (e.pageY-4)+'px'; el.classList.add('show');
    }
});
document.addEventListener('mouseout', function(e){ if (e.target.closest('[data-tooltip]')) document.getElementById('customTooltip').classList.remove('show'); });

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –∏ –ø–∞–ø–æ–∫
document.getElementById('btn-chat-recipients')?.addEventListener('click', function() {
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
    if (typeof openModal === 'function') {
        openModal('chatRecipientsModal', 'chatRecipients', 'chatRecipientsTextarea', 'lineNumbersChatRecipients', 'chatRecipientsLineCount');
    } else {
        showModal('chatRecipientsModal');
    }
});

document.getElementById('btn-chat-message')?.addEventListener('click', function() {
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è
    if (typeof openModal === 'function') {
        openModal('chatMessageModal', 'chatMessage', 'chatMessageTextarea', 'lineNumbersChatMessage', 'chatMessageLineCount');
    } else {
        showModal('chatMessageModal');
    }
});

document.getElementById('btn-chat-attachments')?.addEventListener('click', function() {
    fetch('/api/open-folder?path=–§–∞–π–ª—ã/–†–∞—Å—Å—ã–ª–∫–∞ –ø–æ —á–∞—Ç–∞–º/–ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º—ã–µ —Ñ–∞–π–ª—ã')
        .then(response => {
            if (!response.ok) {
                return response.text().then(errorMessage => {
                    if (typeof showNotification === 'function') {
                        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏: ' + errorMessage, 'error');
                    } else {
                        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏: ' + errorMessage);
                    }
                });
            }
            if (typeof showNotification === 'function') {
                showNotification('–ü–∞–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞', 'success');
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏:', error);
            if (typeof showNotification === 'function') {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏: ' + error.message, 'error');
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏: ' + error.message);
            }
        });
});

document.getElementById('btn-chat-links')?.addEventListener('click', function() {
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Å—ã–ª–æ–∫
    if (typeof openModal === 'function') {
        openModal('chatLinksModal', 'chatLinks', 'chatLinksTextarea', 'lineNumbersChatLinks', 'chatLinksLineCount');
    } else {
        showModal('chatLinksModal');
    }
});

document.getElementById('btn-chat-reports')?.addEventListener('click', function() {
    fetch('/api/open-folder?path=–§–∞–π–ª—ã/–†–∞—Å—Å—ã–ª–∫–∞ –ø–æ —á–∞—Ç–∞–º/–û—Ç—á–µ—Ç—ã')
        .then(response => {
            if (!response.ok) {
                return response.text().then(errorMessage => {
                    if (typeof showNotification === 'function') {
                        showNotification('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏: ' + errorMessage, 'error');
                    } else {
                        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–ø–∫–∏: ' + errorMessage);
                    }
                });
            }
            if (typeof showNotification === 'function') {
                showNotification('–ü–∞–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞', 'success');
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏:', error);
            if (typeof showNotification === 'function') {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏: ' + error.message, 'error');
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏: ' + error.message);
            }
        });
});
</script>
{% endblock %}


